<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="第九届中科大信息安全大赛（Hackergame 2022）的经历与题解"><title>2022 中科大信息安全大赛题解</title><link rel=canonical href=https://viflythink.com/Hackergame_2022_writeups/><link rel=stylesheet href=/scss/style.min.450926226e724574a6b936335ea06111f8aeb253d932c86cb2cc807341cd2889.css><meta property="og:title" content="2022 中科大信息安全大赛题解"><meta property="og:description" content="第九届中科大信息安全大赛（Hackergame 2022）的经历与题解"><meta property="og:url" content="https://viflythink.com/Hackergame_2022_writeups/"><meta property="og:site_name" content="Vifly 的博客"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="信息安全"><meta property="article:published_time" content="2022-11-05T00:00:00+08:00"><meta property="article:modified_time" content="2022-11-05T00:00:00+08:00"><meta property="og:image" content="https://viflythink.com/Hackergame_2022_writeups/show.jpg"><meta name=twitter:title content="2022 中科大信息安全大赛题解"><meta name=twitter:description content="第九届中科大信息安全大赛（Hackergame 2022）的经历与题解"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://viflythink.com/Hackergame_2022_writeups/show.jpg"><link rel="shortcut icon" href=img/favicon.png><meta name=google-site-verification content="o-widUnxdyv8T6wPC_NGLfDgKUwgv2-zMnQhKLKul3Y"><meta name=msvalidate.01 content="D8C8D2BAD9DA419D96DA79455FC4DDBC"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu139cde8ab2a45f6f8ca9b1d680d35535_828870_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Vifly 的博客</a></h1><script>fetch("https://api.github.com/gists/7a04e2188185ddb19cbd19d8217b9400").then(e=>{if(e.ok)return e.json();throw new Error("Unable to fetch gist slogans.")}).then(e=>JSON.parse(e.files["slogans.json"].content)).then(e=>e[Math.floor(Math.random()*e.length)].content).then(e=>{document.getElementById("slogan").innerHTML="<h2 id='slogan' class='site-description'>"+e+"</h2>"})</script><h2 id=slogan class=site-description></h2></div></header><ol class=social-menu><li><a href=mailto:viflythink@gmail.com target=_blank title=Email><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg></a></li><li><a href=https://github.com/vifly target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://viflythink.com/atom.xml target=_blank title=RSS><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://t.me/viflythink target=_blank title=Telegram><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://twitter.com/viflythink target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/ target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/tags/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg><span>Tags</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><li><a href=/service/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-cloud" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 18a4.6 4.4.0 010-9 5 4.5.0 0111 2h1a3.5 3.5.0 010 7H7"/></svg><span>Service</span></a></li><li><a href=/gpg/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-key" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="8" cy="15" r="4"/><line x1="10.85" y1="12.15" x2="19" y2="4"/><line x1="18" y1="5" x2="20" y2="7"/><line x1="15" y1="8" x2="17" y2="10"/></svg><span>GPG key</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/Hackergame_2022_writeups/><img src=/Hackergame_2022_writeups/show_hu93f117fa8a9f2091bb1e93e4a16b32af_325315_800x0_resize_q75_box.jpg srcset="/Hackergame_2022_writeups/show_hu93f117fa8a9f2091bb1e93e4a16b32af_325315_800x0_resize_q75_box.jpg 800w, /Hackergame_2022_writeups/show_hu93f117fa8a9f2091bb1e93e4a16b32af_325315_1600x0_resize_q75_box.jpg 1600w" width=800 height=479 loading=lazy alt="Featured image of post 2022 中科大信息安全大赛题解"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/Hackergame_2022_writeups/>2022 中科大信息安全大赛题解</a></h2><h3 class=article-subtitle>第九届中科大信息安全大赛（Hackergame 2022）的经历与题解</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2022 年 11 月 05 日</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><p>又到了游玩 Hackergame 的时节，欢迎各位读者阅读本期的年更博文。今年博主拿到了 1300 分，与<a class=link href=https://viflythink.com/Hackergame_2021_writeups/ target=_blank rel=noopener>上一年</a>相比，得分有所增加，排名反倒落后了😂；尽管如此，今年依然玩的很开心，下面就让我分享一下自己的题解吧。</p><h1 id=签到>签到</h1><p>打开题目页面，随便点了两下后点击“提交”，发现跳转到的页面 URL 中含有一个 result 参数，既然是 web 方向的题目，那么估计今年的签到题也是简单修改一下请求参数就可以拿到 flag 了，注意到题目描述中有：</p><blockquote><p>在 CPU 来得及反应之前顺利签下 2022</p></blockquote><p>根据这个提示把 result 的值改为 2022 试试，flag 就这样出现了：</p><p><img src=/Hackergame_2022_writeups/get_2022_qiandao_flag.png width=1915 height=1018 loading=lazy alt="成功获取签到题的 flag" class=gallery-image data-flex-grow=188 data-flex-basis=451px></p><h1 id=猫咪问答喵>猫咪问答喵</h1><p>这次的题目与之前两次的猫咪问答有点区别，基本上没有什么提问适合用暴力破解的方式解决，所以今年我全靠谷歌搜索完成。</p><p>第一小题，直接搜索关键词找到一篇<a class=link href=https://cybersec.ustc.edu.cn/2022/0826/c23847a565848/page.htm target=_blank rel=noopener>新闻稿</a>，里面提到：</p><blockquote><p>中国科学技术大学“星云战队（Nebula）”成立于2017年3月</p></blockquote><p>第二小题找起来有点麻烦，首先找到<a class=link href=https://lug.ustc.edu.cn/wiki/lug/events/sfd/#2022-%E5%B9%B4-sfd target=_blank rel=noopener> USTC LUG 的软件自由日历史记录</a>，然后打开“闪电演讲：《GNOME Wayland 使用体验：一个普通用户的视角》”对应的<a class=link href=https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2022.9.20_%E8%BD%AF%E4%BB%B6%E8%87%AA%E7%94%B1%E6%97%A5/slides/gnome-wayland-user-perspective.pdf target=_blank rel=noopener> slides</a>，在其中找到如下内容：</p><p><img src=/Hackergame_2022_writeups/gnome_wayland_kdenlive.png width=1236 height=666 loading=lazy alt="GNOME Wayland 下的 KDE 程序问题" class=gallery-image data-flex-grow=185 data-flex-basis=445px></p><p>在看到截图中标题包含的 HD 1080p 25 fps 以及菜单内容后，我们可以合理猜测这是一个视频剪辑应用，而 KDE 家的著名视频剪辑应用当然就是 Kdenlive。</p><p>第三小题玩了一个今年的梗，该梗出自<a class=link href=https://hostloc.com/thread-1078729-1-1.html target=_blank rel=noopener> Windows 2000 撑不下去了，还有其他 NT4.0 的系统可以用吗？</a>，该帖子里的楼主说经过他修改的 Firefox 能用到 28.0，而根据<a class=link href=https://support.mozilla.org/en-US/questions/1052888#answer-706143 target=_blank rel=noopener> Mozilla 技术支持的说法</a>，官方支持 Windows 2000 的最后一个版本是 12.0，所以答案是 12。</p><p>第四小题是最麻烦的，搜索“CVE-2021-4034”与“Linux kernel argc == 0”等关键词后找到<a class=link href=https://lwn.net/Articles/882799/ target=_blank rel=noopener> LWN 上的一篇文章</a>，当中提到了<a class=link href=https://lwn.net/ml/linux-kernel/20220126043947.10058-1-ariadne@dereferenced.org/ target=_blank rel=noopener>最早尝试修复这个漏洞的补丁</a>，根据这个补丁的内容，其修改了 fs/exec.c 中 do_execveat_common 函数的逻辑。接下来该怎么找对应的提交哈希值呢，在 Linux 内核官网的 Git 前端找？这可太麻烦了，值得庆幸的是内核源码在 GitHub 是有镜像仓库的，所以使用 GitHub 网页的 Blame 功能就比较轻松了，打开其中的 <a class=link href=https://github.com/torvalds/linux/blob/master/fs/exec.c target=_blank rel=noopener>fs/exec.c</a>，点击 Blame 按钮然后 Ctrl + F 查找 do_execveat_common，就可以找到<a class=link href=https://github.com/torvalds/linux/blame/27bc50fc90647bbf7b734c3fc306a5e61350da53/fs/exec.c#L1900 target=_blank rel=noopener>已经经过修复的代码所在的位置</a>了，在网页左侧显示的就是<a class=link href=https://github.com/torvalds/linux/commit/dcd46d897adb70d63e025f175a00a89797d31a43 target=_blank rel=noopener>我们要找的提交</a>。</p><p>第五小题，直接搜索“e4:ff:65:d7:be:5d:c8:44:1d:89:6b:50:f5:50:a0:ce”这一串指纹，找到了一条<a class=link href=https://gist.github.com/jandryuk/61b286220447300ba9dca0faa26526dd target=_blank rel=noopener> Gist 记录</a>，所以该指纹对应的域名就是 sdf.org。</p><p>最后一道小题，搜索“USTC 网络通定价”的话首先就能看到<a class=link href=https://www.ustc.edu.cn/info/1057/4931.htm target=_blank rel=noopener>这个通知</a>，当我据此输入 2011-01-01 后发现这是错的，仔细一看下面的价格变更表，发现网络通的价格没有变动，所以这里应该再查找通知开头提到的“网字〔2003〕1号《关于实行新的网络费用分担办法的通知》”，<a class=link href=http://ustcnet.ustc.edu.cn/2003/0301/c11109a210890/pagem.htm target=_blank rel=noopener>其中</a>提到 2003 年 3 月 1 日起实行，由此得到 2003-03-01 这一正确答案。</p><h1 id=家目录里的秘密>家目录里的秘密</h1><p>尝试使用 ripgrep 暴力搜索 flag 相关的文字：</p><p><img src=/Hackergame_2022_writeups/rg_find_flag.png width=506 height=125 loading=lazy alt="使用 rg 搜索包含 flag 的文件" class=gallery-image data-flex-grow=404 data-flex-basis=971px></p><h2 id=vs-code-里的-flag>VS Code 里的 flag</h2><p>逐个查看找到的文件，在 .config/Code/User/History/2f23f721/DUGV.c 的第五行找到了 flag。</p><h1 id=heilang>HeiLang</h1><p>黑话与蛇语有什么联系呢，研究一下本题给出的代码后就会发现所谓的 HeiLang 就是一个简单的 Python 魔改版。要用 Python 解释器执行的话，需要先转换一下语法，把含有“|”的语句展开为 Python 的列表赋值语句。总的来说是很轻松的文本查找替换工作，这里我写了<a class=link href=https://gist.github.com/vifly/1f23c692a07967c3a3175579656177cd#file-convert_hei-py target=_blank rel=noopener>一个脚本</a>用来生成可以符合 Python 语法的 getflag.py。<em>PS：也可以不保存然后直接用 eval 执行。</em></p><h1 id=xcaptcha>Xcaptcha</h1><p>如何证明自己是机器人，在一秒内解出三道计算题就行了。从题目描述来看是需要自己写代码进行计算了，本题可以算是 Web 爬虫的入门考验，没有任何反爬措施，只要发送请求获取网页内容，然后从中提取要计算的题目并把计算后的结果通过 post 请求发送回去即可。看<a class=link href=https://gist.github.com/vifly/1f23c692a07967c3a3175579656177cd#file-hack_xcaptcha-py target=_blank rel=noopener>我的脚本</a>就可以理解这样一个简单的爬虫是如何实现的。</p><h1 id=旅行照片-20>旅行照片 2.0</h1><p>难得的社会工程学题目，再次说明了一张照片能暴露多少个人信息，此类题目都十分有趣，本题也不算难，仅仅是照片上的体育馆横幅文字就能看出拍摄地点在千叶市 Zozo 海洋球馆附近。虽说如此，上一年的旅行照片我没解出来，今年的这道题则因为没找到能免费显示五个月前航班历史记录的网站而没解决第二小题。<em>PS：赛后发现 <a class=link href=https://globe.adsbexchange.com/?r target=_blank rel=noopener>ADSB Exchange</a> 提供了免费的长期历史回放功能，但由于其界面过于复古，我在比赛时没找到该功能。😂</em></p><h2 id=照片分析>照片分析</h2><p>安装 <a class=link href=https://exiftool.org target=_blank rel=noopener>exiftool</a> 就可以查看照片的 EXIF 信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>exiftool ./travel-photo-2.jpg
</span></span></code></pre></div><p>这里有点坑的地方在于其显示的 EXIF 信息版本需要转换一下，0231 需要转为 2.31 才是正确的答案，其它的答案都是对照 EXIF 填写即可。</p><h1 id=latex-机器人>LaTeX 机器人</h1><h2 id=纯文本>纯文本</h2><p>又是一个因完全信任用户输入而导致 flag 泄露的案例。我并不熟悉 LaTeX，在阅读了后端代码后以为是要在输入的 LaTeX 语句中注入 Shell 命令才能拿到 flag，随手一搜“LaTeX inject”就找到了<a class=link href=https://0day.work/hacking-with-latex/ target=_blank rel=noopener>说明 CTF 中 LaTeX 可利用之处的文章</a>。按该文的说法，存在 -no-shell-escape 参数的情况下，在 LaTeX 中执行 Shell 命令是不行的，但 LaTeX 自身就有一个用于读取文件的宏：\input，所以第一小题只需要输入<code>\input{/flag1}</code>就能把 flag 放到返回的图片中，然后对图片进行 OCR 并补上括号就可以完成本题了。</p><p><img src=/Hackergame_2022_writeups/get_flag1_from_latex_bot.png width=1027 height=703 loading=lazy alt="从 LaTex 机器人获取 flag" class=gallery-image data-flex-grow=146 data-flex-basis=350px></p><h1 id=flag-的痕迹>Flag 的痕迹</h1><p>Dokuwiki 作为一个成熟的软件，我们恐怕难以能找到绕过其 Action 管理的方法，所以需要从其它的方向着手。首先想到的是管理员是否忘记禁用某些同样能查看历史记录的接口，先从可能未禁用的 Action 开始尝试，翻阅<a class=link href=https://www.dokuwiki.org/devel:action_modes target=_blank rel=noopener> Dokuwiki 支持的 Action 列表</a>，发现在 revisions 下面有 diff 这个 Action，从名字来看它也是能获取历史记录的，于是尝试访问 http://202.38.93.111:15004/doku.php?do=diff 并发现 diff 没被禁用，查看之前的版本差异就得到了 flag。</p><p><img src=/Hackergame_2022_writeups/get_flag_from_dokuwiki.png width=1918 height=1017 loading=lazy alt="从 Dokuwiki 获取 flag" class=gallery-image data-flex-grow=188 data-flex-basis=452px></p><h1 id=微积分计算小练习>微积分计算小练习</h1><p>对我来说本题是兼具挑战性与趣味性的一道题目。首先从后端代码开始思考，可以看出其主要的逻辑就是先转换用户提供的 URL（杜绝访问外网的可能性）并把 flag 放到 cookie 里，用 headless chrome 访问转换后的 URL，执行 JavaScript 代码查询网页元素并把结果打印出来。</p><p>到此目标就很清楚了：想办法把 cookie 的内容偷出来，而能否取得 flag 与是否把微积分题目全做出来毫无关系。要获取 cookie 的内容，我们只能从输入的 URL 开始着手，因为从后端代码就可以看出没有其它的选项，所以现在的问题就变成了有什么办法能构造出一个 URL 让浏览器执行任意的代码。仔细一想，这不就是<a class=link href=https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting target=_blank rel=noopener> XSS 攻击</a>吗，真没想到会遇到一道需要参赛者构造 XSS 攻击的题目。</p><p>要进行 XSS 攻击，首先要做的就是阅读目标站点的前端代码，从中寻找可供利用的地方。对于我们来说，浏览器访问的是展示测试分数的页面，所以该页面就是目标页面，其中重要的代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>urlParams</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;result&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>b64decode</span> <span class=o>=</span> <span class=nx>atob</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#greeting&#34;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;您好，&#34;</span> <span class=o>+</span> <span class=nx>username</span> <span class=o>+</span> <span class=s2>&#34;！&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#score&#34;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;您在练习中获得的分数为 &lt;b&gt;&#34;</span> <span class=o>+</span> <span class=nx>score</span> <span class=o>+</span> <span class=s2>&#34;&lt;/b&gt;/100。&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>可以看出这首先会对 result 参数进行 base64 解码，进行一番字符串操作后获得分数和姓名（上面已省略），最后更改对应的元素以进行显示。base64 解码和字符串操作看上去都没什么可利用的地方，那剩下的可能性就隐藏在显示部分了。回想起来，直接对 innerHTML 进行操作是一个不安全的行为，有可能利用这点吗？谷歌“XSS innerHTML”直接就找到了<a class=link href=https://gist.github.com/caike/35522c3da161d29fc2ce target=_blank rel=noopener>一个例子</a>，先在做题页面输入名字 <code>&lt;img src=x onerror="alert(42)"></code> 试试，检查随后打开的显示结果的页面是不是弹出了内容为 42 的对话框。</p><p>测试成功后我们就可以开始构造实际的 payload 了，要做的事情就是把名字改为 <code>&lt;img src=x onerror='document.querySelector("#score").innerHTML=document.cookie'></code>，这样做会导致原本应该显示分数的地方被改为显示 cookie，交给 headless chrome 访问后就可以拿到 flag 了。所以本题输入 http://202.38.93.111:10056/share?result=MDo8aW1nIHNyYz14IG9uZXJyb3I9J2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNzY29yZSIpLmlubmVySFRNTD1kb2N1bWVudC5jb29raWUnPg%3D%3D 这个 URL 就能解决，你也可以通过以下命令构造 result 参数（我用的是 Zsh，注意 Shell 对引号的转义）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Zsh data-lang=Zsh><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;0:&lt;img src=x onerror=&#39;document.querySelector(\&#34;#score\&#34;).innerHTML=document.cookie&#39;&gt;&#34;</span> <span class=p>|</span> base64
</span></span></code></pre></div><p>拿到的 flag 是 flag{xS5_1OI_is_N0t_SOHARD_03d2ec39d4}，嗯，XSS 入门并不难。</p><h1 id=一些没做出来的题目>一些没做出来的题目</h1><p>家目录里的秘密的第二小题，虽然我知道 flag2 应该在 .config/rclone/rclone.conf 里，但居然没想到里面的 pass 项是以密文形式存储的，需要阅读 Rclone 中的对应源码才能将其还原为明文获取 flag。</p><p>猜数字，我只能说没有熟读 IEEE 754 标准真是容易吃亏啊，计算机的浮点数表示总有些违反直觉，本题就体现了这一点：对于任意 a，a ≠ NaN 成立，但 a &lt; NaN 或 NaN &lt; a 均不成立。所以对应的代码用了一种很奇怪的方式判断猜测的数字是否正确：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>var</span> <span class=n>isLess</span> <span class=o>=</span> <span class=n>guess</span> <span class=o>&lt;</span> <span class=k>this</span><span class=o>.</span><span class=na>number</span> <span class=o>-</span> <span class=n>1e</span><span class=o>-</span><span class=n>6</span> <span class=o>/</span> <span class=n>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>isMore</span> <span class=o>=</span> <span class=n>guess</span> <span class=o>&gt;</span> <span class=k>this</span><span class=o>.</span><span class=na>number</span> <span class=o>+</span> <span class=n>1e</span><span class=o>-</span><span class=n>6</span> <span class=o>/</span> <span class=n>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=n>isPassed</span> <span class=o>=</span> <span class=o>!</span><span class=n>isLess</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>isMore</span><span class=o>;</span>
</span></span></code></pre></div><p>二次元神经网络，作为一个炼丹师看到这题可谓是倍感亲切。除非弄个 web 九宫格，神经网络也算 web 类题目，不然本题是不需要参赛者训练神经网络的，我也猜出需要在上传的模型中注入代码并让其被执行，只是因懒得想需要执行什么代码才能拿到 flag 就放弃了。这道题提醒了我们要通过模型进行 RCE（任意代码执行）是如此的简单，所以不要随便加载从网上下载的模型。虽说如此，就我个人观察而言，别说只是想玩下 AI 生成图片的业余人士，就算是业内人士也有不少并不在意这个安全问题，感觉这会成为一个常见的安全风险来源。</p><h1 id=总结>总结</h1><p>很不巧的，今年的比赛期间我正好沉迷于斯普拉遁3，所以没投入太多时间和精力来打比赛；而且这一年来也没怎么研究 binary 与 math 类的题目，所以对于这些类型的题目束手无策。总之，虽说今年的比赛也玩的挺开心，但并没有什么进步，我对于没能在 Hackergame 成功挑战自我这一点还是有些遗憾的，希望明年的自己能够更进一步吧。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/>信息安全</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>Related contents</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/Hackergame_2021_writeups/><div class=article-image><img src=/Hackergame_2021_writeups/show.02a042ed813f37a77d72aef0074d5c68_hued1753f52dabbdb4ad30a094c50ac508_1372538_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 2021 中科大信息安全大赛题解" data-hash="md5-AqBC7YE/N6d9cq7wB01caA=="></div><div class=article-details><h2 class=article-title>2021 中科大信息安全大赛题解</h2></div></a></article><article class=has-image><a href=/Hackergame_2020_writeups/><div class=article-image><img src=/Hackergame_2020_writeups/show.961f9901878e2b82abaaeb7e1f326343_hu047d013128609b76bc4f6f1998ad3a88_1069728_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 中科大信息安全大赛初体验" data-hash="md5-lh+ZAYeOK4Krqut+HzJjQw=="></div><div class=article-details><h2 class=article-title>中科大信息安全大赛初体验</h2></div></a></article><article class=has-image><a href=/translate_elliptic_curve_cryptography_explained/><div class=article-image><img src=/translate_elliptic_curve_cryptography_explained/show.8ac351075994593ec66b34bae84b47b5_hu5601238948948f72ac070df8361310aa_232702_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post 【译】椭圆曲线密码介绍" data-hash="md5-isNRB1mUWT7GazS66EtHtQ=="></div><div class=article-details><h2 class=article-title>【译】椭圆曲线密码介绍</h2></div></a></article></div></div></aside><div id=isso-comment><script data-isso=https://comments.viflythink.com/isso/ data-isso-css=true data-isso-lang=zh_CN data-isso-reply-to-self=true data-isso-require-author=true data-isso-require-email=false data-isso-max-comments-top=10 data-isso-max-comments-nested=5 data-isso-reveal-on-click=5 data-isso-avatar=true data-isso-vote=true data-isso-vote-levels data-isso-feed=false src=https://comments.viflythink.com/isso/js/embed.min.js></script><section id=isso-thread></section></div><style>#isso-comment{background-color:#eee;padding:2pc}</style><footer class=site-footer><section class=copyright>&copy;
2019 -
2023 Vifly 的博客</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://viflythink.com/js/photoswipe.min.js crossorigin=anonymous defer></script><script src=https://viflythink.com/js/photoswipe-ui-default.min.js crossorigin=anonymous defer></script><link rel=stylesheet href=https://viflythink.com/css/default-skin.css crossorigin=anonymous><link rel=stylesheet href=https://viflythink.com/css/photoswipe.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#签到>签到</a></li><li><a href=#猫咪问答喵>猫咪问答喵</a></li><li><a href=#家目录里的秘密>家目录里的秘密</a><ol><li><a href=#vs-code-里的-flag>VS Code 里的 flag</a></li></ol></li><li><a href=#heilang>HeiLang</a></li><li><a href=#xcaptcha>Xcaptcha</a></li><li><a href=#旅行照片-20>旅行照片 2.0</a><ol><li><a href=#照片分析>照片分析</a></li></ol></li><li><a href=#latex-机器人>LaTeX 机器人</a><ol><li><a href=#纯文本>纯文本</a></li></ol></li><li><a href=#flag-的痕迹>Flag 的痕迹</a></li><li><a href=#微积分计算小练习>微积分计算小练习</a></li><li><a href=#一些没做出来的题目>一些没做出来的题目</a></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside></div><script src=https://viflythink.com/js/vibrant.min.js crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>