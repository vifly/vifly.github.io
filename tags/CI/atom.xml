<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>CI on Vifly çš„åšå®¢</title><link>https://viflythink.com/tags/CI/</link><description>Recent content in CI on Vifly çš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Fri, 12 Nov 2021 00:00:00 +0800</lastBuildDate><atom:link href="https://viflythink.com/tags/CI/atom.xml" rel="self" type="application/rss+xml"/><item><title>ä½¿ç”¨ Vercel ä¸ OneDrive è‡ªå»ºè½¯ä»¶æº</title><link>https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/</link><pubDate>Sat, 04 Sep 2021 00:00:00 +0800</pubDate><guid>https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/</guid><description>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/show.jpg" alt="Featured image of post ä½¿ç”¨ Vercel ä¸ OneDrive è‡ªå»ºè½¯ä»¶æº" />&lt;p>&lt;em>2021.11.12.æ›´æ–°ï¼šå¢åŠ äº†å…³äº GPG ç­¾åçš„è¯´æ˜ã€‚&lt;/em>
&lt;em>2024.11.23.æ›´æ–°ï¼šç°åœ¨æ”¯æŒä¸Šä¼ è½¯ä»¶åŒ…åˆ°å…¶å®ƒ Rclone æ”¯æŒçš„äº‘å­˜å‚¨äº†ï¼Œæ‰€ä»¥æ›´æ–°äº†å¯¹ uploadToOneDrive job çš„è¯´æ˜ã€‚&lt;/em>&lt;/p>
&lt;p>å¤§å®¶å¥½ï¼Œåˆæ˜¯æœ¬é¸½å­ä¹…è¿çš„åšå®¢æ›´æ–°ã€‚ä¹‹å‰çš„&lt;a class="link" href="https://viflythink.com/Use_GitHubActions_to_build_AUR" target="_blank" rel="noopener"
>ã€ŠGitHub Actions æ‰“é€  AUR æ‰“åŒ…ä¸‹è½½ä¸€æ¡é¾™æœåŠ¡ã€‹&lt;/a>å·²ç»æŠ˜è…¾å‡ºäº†å®Œå…¨ç™½å«–çš„ç¼–è¯‘æœºï¼Œå¯å¥½æ™¯ä¸é•¿ï¼Œå½“æˆ‘çš„æœºå™¨æ•°é‡å˜å¤šåï¼Œæˆ‘å‘ç°åœ¨æ¯å°æœºå™¨ä¸Šè¿è¡Œè„šæœ¬ä¸‹è½½è½¯ä»¶åŒ…çš„ç¡®æœ‰ç‚¹éº»çƒ¦ï¼Œä¸å…¶è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬ä¸‹è½½è½¯ä»¶åŒ…ï¼Œè¿˜ä¸å¦‚ç›´æ¥è‡ªå»ºä¸€ä¸ªè½¯ä»¶æºå‘¢ã€‚ç»è¿‡ä¸€ç•ªç ”ç©¶åï¼Œæˆ‘ç›¯ä¸Šäº† OneDrive ä¸ Vercel è¿™ä¸¤ä¸ªå¯ä»¥å…è´¹ä½¿ç”¨çš„æœåŠ¡ï¼Œé€šè¿‡å®ƒä»¬å®ç°äº†è‡ªå»ºä¸€ä¸ªå®Œå…¨å…è´¹è€Œä¸”åœ¨å›½å†…å¤–éƒ½å¯é«˜é€Ÿè®¿é—®çš„è½¯ä»¶æºã€‚&lt;/p>
&lt;p>æœ¬æ–‡æ˜¯å¯¹&lt;a class="link" href="https://viflythink.com/Use_GitHubActions_to_build_AUR" target="_blank" rel="noopener"
>ã€ŠGitHub Actions æ‰“é€  AUR æ‰“åŒ…ä¸‹è½½ä¸€æ¡é¾™æœåŠ¡ã€‹&lt;/a>çš„æ‰©å±•ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰è¯»è¿‡è¯¥åšæ–‡ï¼Œè¯·å…ˆè¯»å®Œå®ƒå†å›æ¥é˜…è¯»æœ¬æ–‡ã€‚é€šè¿‡å‰æ–‡ä¸æœ¬æ–‡ï¼Œä½ å¯ä»¥åœ¨æ²¡æœ‰æœåŠ¡å™¨ï¼Œä¸èŠ±ä¸€åˆ†é’±çš„æƒ…å†µä¸‹æ­å»ºä¸€ä¸ªåŸºäº OneDrive çš„é«˜é€Ÿè‡ªå»ºè½¯ä»¶ä»“åº“ï¼Œä½“éªŒåˆ°ç™½å«–ä¸æŠ˜è…¾ Linux çš„åŒé‡å¿«ä¹ã€‚&lt;/p>
&lt;p>ä¸ºäº†å¾—åˆ°ä¸€ä¸ªå…¬å¼€çš„è½¯ä»¶ä»“åº“ï¼Œåªæ˜¯æŠŠè½¯ä»¶åŒ…æ„å»ºå‡ºæ¥å¹¶æ”¾åˆ° GitHub Release æ˜¯ä¸å¤Ÿçš„ï¼Œæ²¡æœ‰è½¯ä»¶åŒ…æ•°æ®åº“ï¼Œè½¯ä»¶åŒ…ç®¡ç†å™¨å¯ä¸çŸ¥é“å¦‚ä½•è·å–è¿™äº›è½¯ä»¶åŒ…ï¼Œæ›´ä¸ç”¨ææ ¡éªŒä¸å®‰è£…ç­‰ç­‰ã€‚ç”Ÿæˆè½¯ä»¶åŒ…æ•°æ®åº“åªéœ€è¦ä¸€è¡Œ &lt;code>repo-add ./reponame.db.tar.gz *.tar.zst&lt;/code>ï¼Œç„¶åæŠŠå®ƒä»¬éƒ½æ”¾åˆ° GitHub Release è¿™æ ·çš„å…è´¹å­˜å‚¨åç«¯å°±å¯ä»¥è§£å†³åˆ†å‘é—®é¢˜äº†ï¼Œå®é™…ä¸Šæœ‰ä¸€ä¸ª &lt;a class="link" href="https://github.com/Brx86/repo" target="_blank" rel="noopener"
>arch-build çš„ fork&lt;/a> å°±æ˜¯è¿™æ ·åšçš„ã€‚å½“ç„¶ï¼Œæˆ‘å¯¹å…¶è¿˜æ˜¯ä¸å¤Ÿæ»¡æ„ï¼Œé€šè¿‡ fastgit ç­‰ GitHub åä»£æœåŠ¡çš„ç¡®å¯ä»¥åŠ é€Ÿ GitHub Release çš„ä¸‹è½½é€Ÿåº¦ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿç¨³å®šï¼›è¿˜æœ‰ä¸€ä¸ªæ›´é‡è¦çš„åŸå› ï¼Œæˆ‘ä¸ä»…æƒ³è¦è‡ªå»º Arch è½¯ä»¶æºï¼Œä¹Ÿæƒ³è¦è‡ªå»º Debian è½¯ä»¶æºï¼Œè€Œ GitHub Release çš„è·¯å¾„ä¸å¤Ÿçµæ´»ï¼Œæ— æ³•æ„é€ åƒ yourrepo.com/debian/pool/main/n/nginx/ è¿™æ ·çš„ URLï¼Œæ²¡æ³•æ»¡è¶³è‡ªå»º Debian è½¯ä»¶æºçš„éœ€æ±‚ã€‚æ‰€ä»¥å˜›ï¼Œåªèƒ½è‡ªå·±å†é€ ä¸€ä¸ªè½®å­äº†ã€‚&lt;/p>
&lt;p>åœ¨çœ‹ä¸‹æ–‡ä¹‹å‰ï¼Œä¸å¦¨å…ˆæ‰“å¼€&lt;a class="link" href="https://archrepo.viflythink.com/" target="_blank" rel="noopener"
>æˆ‘çš„è‡ªå»ºä»“åº“&lt;/a>é¡µé¢æŸ¥çœ‹æœ€ç»ˆæ•ˆæœï¼Œå¦‚æœæƒ³ä½¿ç”¨æˆ‘çš„è‡ªå»ºè½¯ä»¶æºï¼Œéœ€è¦å…ˆæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å¯¼å…¥ GPG å…¬é’¥ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>wget -O /tmp/vifly-repo.key &amp;#39;https://share.viflythink.com/arch-repo.key&amp;#39; &amp;amp;&amp;amp; sudo pacman-key --add /tmp/vifly-repo.key
sudo pacman-key --lsign-key viflythink@gmail.com
&lt;/code>&lt;/pre>&lt;p>ç„¶ååœ¨ /etc/pacman.conf æœ«å°¾æ·»åŠ ä¸‹é¢å‡ è¡Œåæ‰§è¡Œ pacman -Syuï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>[vifly]
Server = https://archrepo.viflythink.com
&lt;/code>&lt;/pre>&lt;p>å°½ç®¡æœ¬æ–‡æœ€ç»ˆæä¾›çš„æˆå“ç›®å‰åªç”¨åœ¨ Arch è‡ªå»ºæºä¸Šï¼Œä½†å¯¹è„šæœ¬ç¨åŠ ä¿®æ”¹åä¹Ÿå¯ä»¥ç”¨æ¥è‡ªå»ºå…¶å®ƒ Linux å‘è¡Œç‰ˆçš„è½¯ä»¶ä»“åº“ã€‚&lt;/p>
&lt;h1 id="ä¸Šä¼ åˆ°-onedrive">ä¸Šä¼ åˆ° OneDrive
&lt;/h1>&lt;p>ä¹‹å‰é…ç½®çš„ GitHub Actions å·²ç»å¯ä»¥æŠŠè½¯ä»¶åŒ…ä¸Šä¼ åˆ° Release ä¸Šï¼Œç°åœ¨åªéœ€è¦å¯¹åŸæ¥çš„é…ç½®æ–‡ä»¶ç¨åŠ æ”¹é€ å°±å¯ä»¥è®© GitHub Actions æŠŠè½¯ä»¶åŒ…ä¹Ÿä¸Šä¼ åˆ° OneDriveï¼Œä¸ºäº†å°½é‡ä¸é‡å¤é€ è½®å­ï¼Œåœ¨è¿™é‡Œæˆ‘é€‰æ‹©äº† Rclone è¿›è¡Œä¸Šä¼ ï¼Œå®ƒæä¾›äº†éå¸¸å®Œå–„çš„æ–‡ä»¶ä¼ è¾“åŠŸèƒ½ï¼Œä¾‹å¦‚ä¸Šä¼ æˆ–ä¸‹è½½æ—¶é‡åˆ°æ–‡ä»¶å†…å®¹ç›¸åŒçš„æƒ…å†µä¼šè‡ªåŠ¨è·³è¿‡ã€‚&lt;/p>
&lt;h2 id="åœ¨-azure-åˆ›å»ºåº”ç”¨">åœ¨ Azure åˆ›å»ºåº”ç”¨
&lt;/h2>&lt;p>æ ¹æ® &lt;a class="link" href="https://rclone.org/onedrive/#getting-your-own-client-id-and-key" target="_blank" rel="noopener"
>Rclone çš„å®˜æ–¹æ–‡æ¡£&lt;/a>æ“ä½œå³å¯ï¼Œä»¥ä¸‹ç»™å‡ºå›¾æ–‡æ“ä½œæ­¥éª¤ã€‚å°½ç®¡ Rclone å®˜æ–¹è®¤ä¸ºè¿™æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨ Vercel éƒ¨ç½²ç›´é“¾ä¸‹è½½åº”ç”¨æ—¶ä¹Ÿéœ€è¦åœ¨ Azure åˆ›å»ºåº”ç”¨è·å– Tokenï¼Œæ‰€ä»¥ä¾¿æŠŠç›¸å…³æ­¥éª¤æ”¾è¿™é‡Œäº†ï¼Œå¦å¤–åŸºäºæƒé™æœ€å°åŒ–çš„åŸåˆ™ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ‹¥æœ‰è¯»å†™æƒé™çš„åº”ç”¨ï¼Œè€Œåœ¨ Vercel éƒ¨ç½²æ—¶åˆ™æ˜¯åˆ›å»ºä¸€ä¸ªå…·æœ‰åªè¯»æƒé™çš„åº”ç”¨ï¼Œä¸¤ä¸ªåº”ç”¨ç”¨åœ¨ä¸åŒçš„åœ°æ–¹ï¼Œè¿™æ ·å¯æœ‰æ•ˆæå‡å®‰å…¨æ€§ã€‚&lt;/p>
&lt;p>æ‰“å¼€ &lt;a class="link" href="https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade" target="_blank" rel="noopener"
>Azure çš„åº”ç”¨ç®¡ç†é¡µé¢&lt;/a>ï¼Œç‚¹å‡» New registrationã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/azure_applist.png"
width="1914"
height="786"
loading="lazy"
alt="Azure åº”ç”¨åˆ—è¡¨"
class="gallery-image"
data-flex-grow="243"
data-flex-basis="584px"
>&lt;/p>
&lt;p>åœ¨æ‰“å¼€çš„ç•Œé¢ä¸­è¾“å…¥åº”ç”¨çš„åå­—ï¼ˆè¿™é‡Œæˆ‘ç”¨äº† rclone è¿™ä¸ªåå­—ï¼‰ï¼ŒSupported account types è¿™ä¸€é¡¹é€‰æ‹©å›¾ä¸­çš„ç¬¬äºŒé¡¹ï¼ˆä¹Ÿæ˜¯åŒ…å«èŒƒå›´æœ€å¹¿æ³›çš„é‚£é¡¹ï¼‰ï¼Œåœ¨ Redirect URI (optional) è¿™ä¸€é¡¹é€‰æ‹© Web å¹¶åœ¨å³è¾¹çš„è¾“å…¥æ¡†é‡Œè¾“å…¥ http://localhost:53682/ è¿™ä¸€ç½‘å€ã€‚å®Œæˆåç‚¹å‡» Registerã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/azure_app_register.png"
width="1904"
height="878"
loading="lazy"
alt="Azure æ³¨å†Œåº”ç”¨"
class="gallery-image"
data-flex-grow="216"
data-flex-basis="520px"
>&lt;/p>
&lt;p>æ­¤æ—¶åº”ç”¨å·²ç»æ³¨å†Œå®Œæˆï¼Œè®°å½•ä¸‹ Application (client) ID çš„å€¼ï¼Œè¿™å°±æ˜¯ä¸‹æ–‡ä¼šç”¨åˆ°çš„ client idã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/azure_get_client_id.png"
width="1918"
height="876"
loading="lazy"
alt="Azure è·å– client id"
class="gallery-image"
data-flex-grow="218"
data-flex-basis="525px"
>&lt;/p>
&lt;p>ç‚¹å‡»å·¦ä¾§èœå•çš„ Certificates &amp;amp; secretsï¼Œç„¶åç‚¹å‡» New client secretï¼Œåœ¨ Description ä¸€æ éšä¾¿å¡«ç‚¹ä»€ä¹ˆï¼ŒæŠŠ Expiresï¼ˆè¿‡æœŸæ—¶é—´ï¼‰è®¾ä¸ºæœ€é•¿çš„ 24 monthsï¼ˆä¸¤å¹´åè®°å¾—æ›´æ–° client secretï¼‰ï¼Œç‚¹å‡» Addã€‚æœ€åè®°å½•ä¸‹æ–°å¢çš„ client secret çš„å€¼ï¼ˆåœ¨å›¾ä¸­æ ‡æ³¨çš„ Valueï¼‰ã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/azure_get_client_secret.png"
width="1918"
height="897"
loading="lazy"
alt="Azure è·å– client secret"
class="gallery-image"
data-flex-grow="213"
data-flex-basis="513px"
>&lt;/p>
&lt;p>åˆ°æ­¤ä¸ºæ­¢å°±å®Œæˆäº†ã€‚æœ‰äº›åŒå­¦å¯èƒ½ä¼šæ„Ÿåˆ°å¥‡æ€ªï¼šRclone æ–‡æ¡£ä¸­ä¸æ˜¯è¿˜æœ‰ç¬¬ 4 ä¸ç¬¬ 5 æ­¥è®¾ç½®æƒé™å—ï¼Ÿæ ¹æ®æˆ‘çš„å®æµ‹ï¼Œè¿™ä¸¤æ­¥å¹¶æ²¡æœ‰å¿…è¦æ‰§è¡Œï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šé™„ä¸Šè¿™ä¸¤æ­¥æ“ä½œçš„ç¤ºæ„å›¾ã€‚&lt;/p>
&lt;h2 id="è·å–-token">è·å– Token
&lt;/h2>&lt;p>åœ¨æœ¬åœ°å®‰è£… Rcloneï¼ˆ&lt;code>pacman -S rclone&lt;/code>ï¼‰ï¼Œè¿è¡Œ rclone config è¿›å…¥äº¤äº’å¼é…ç½®æµç¨‹ï¼Œæ¥ç€&lt;a class="link" href="https://rclone.org/onedrive" target="_blank" rel="noopener"
>ä¸€æ­¥æ­¥åœ°æŒ‰ç…§æç¤ºæ“ä½œ&lt;/a>ï¼Œå½“ç¨‹åºè¯¢é—® Microsoft App Client Id å’Œ Microsoft App Client Secret æ—¶ï¼Œå¡«å…¥ä¸Šä¸€å°èŠ‚ä¸­è®°å½•çš„å¯¹åº”å€¼ã€‚&lt;/p>
&lt;p>å®Œæˆé…ç½®å Rclone ä¼šæŠŠé…ç½®æ•°æ®å­˜æ”¾åœ¨ ~/.config/rclone/rclone.confï¼Œä½¿ç”¨ &lt;code>cat ~/.config/rclone/rclone.conf&lt;/code> æŸ¥çœ‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸‹æ–‡çš„ RCLONE_CONFIG å°±éœ€è¦æŠŠè¿™äº›ä¸œè¥¿å¤åˆ¶ç²˜è´´è¿›å»ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-INI" data-lang="INI">&lt;span class="line">&lt;span class="cl">&lt;span class="k">[xxx]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">onedrive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">client_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">xxx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">client_secret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">xxx&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">region&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">global&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">drive_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">personal&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">{&amp;#34;access_token&amp;#34;:&amp;#34;xxx&amp;#34;,&amp;#34;token_type&amp;#34;:&amp;#34;Bearer&amp;#34;,&amp;#34;refresh_token&amp;#34;:&amp;#34;xxx&amp;#34;,&amp;#34;expiry&amp;#34;:&amp;#34;xxx&amp;#34;}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">drive_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">xxx&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é…ç½®-github-actions">é…ç½® GitHub Actions
&lt;/h2>&lt;p>é¦–å…ˆ fork &lt;a class="link" href="https://github.com/vifly/arch-build" target="_blank" rel="noopener"
>arch-build ä»“åº“&lt;/a>ï¼Œå¦‚æœä½ åœ¨ä¹‹å‰å·²ç»ä½¿ç”¨äº†å®ƒï¼Œè®°å¾—åŒæ­¥åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ä¸å‰æ–‡æ‰€ç»™çš„ä¾‹å­ç›¸æ¯”ï¼Œç°åœ¨çš„ workflow æ–‡ä»¶ï¼ˆ.github/workflows/build.ymlï¼‰å¤šäº† uploadToOneDrive è¿™ä¸€ä¸ª jobï¼Œè™½ç„¶æˆ‘è¿™é‡Œç”¨çš„æ˜¯ OneDriveï¼Œä½†å…¶å®ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæŠŠè½¯ä»¶åŒ…ä¸Šä¼ åˆ°å…¶å®ƒ Rclone æ”¯æŒçš„äº‘å­˜å‚¨ä¸Šã€‚&lt;/p>
&lt;p>${{ secrets.xxx }} è¿™æ ·çš„å˜é‡éƒ½æ˜¯éœ€è¦åœ¨ GitHub çš„é¡¹ç›®é…ç½®ä¸­çš„ Secrets ä¸€æ è®¾ç½®çš„ç§å¯†å˜é‡ï¼Œæ‰“å¼€é¡¹ç›®çš„ Settingsï¼Œæ‰¾åˆ°ä¸‹å›¾æ‰€ç¤ºçš„ç•Œé¢ï¼Œç„¶åç‚¹å‡» New repository secretï¼Œå¹¶å¡«å…¥ RCLONE_CONFIG è¿™ä¸ªå˜é‡çš„å€¼ï¼ˆæŠŠä¸Šä¸€å°èŠ‚çš„ rclone.conf å†…å®¹å¤åˆ¶ç²˜è´´è¿›å»å³å¯ï¼‰ã€‚å…·ä½“çš„æ“ä½œä¹Ÿå¯å‚è€ƒ &lt;a class="link" href="https://docs.github.com/en/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository" target="_blank" rel="noopener"
>GitHub å®˜æ–¹æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/github_actions_add_secret.png"
width="1752"
height="1026"
loading="lazy"
alt="GitHub Actions æ·»åŠ ç§å¯†å˜é‡"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;p>æ¥ç€å›æ¥ä¿®æ”¹ workflow æ–‡ä»¶ï¼Œdest_path æ˜¯ OneDrive ä¸Šä¼ çš„ç›®çš„åœ°è·¯å¾„ï¼ˆå¦‚æœè¯¥è·¯å¾„ä¸å­˜åœ¨ï¼ŒRclone ä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ï¼Œä»¥ Linux æ–‡ä»¶è·¯å¾„çš„å½¢å¼å¡«å†™å³å¯ï¼Œä¸å»ºè®®ä½¿ç”¨æ ¹è·¯å¾„ï¼Œå› ä¸ºæ¥ä¸‹æ¥å°†ä¼šæŠŠè¿™ä¸ªè·¯å¾„ä¸‹çš„æ‰€æœ‰ä¸œè¥¿å…¬å¼€ï¼Œå„ä½è‚¯å®šä¸å¸Œæœ›åˆ«äººæ‰“å¼€ä½ çš„è½¯ä»¶ä»“åº“é¡µé¢æ—¶è¿˜çœ‹åˆ°å…¶å®ƒä¹±ä¸ƒå…«ç³Ÿçš„æ–‡ä»¶ï¼›repo_name æ˜¯ä½ çš„è‡ªå»ºè½¯ä»¶ä»“åº“çš„åå­—ï¼Œ&lt;a class="link" href="https://wiki.archlinux.org/title/Pacman/Tips_and_tricks#Custom_local_repository" target="_blank" rel="noopener"
>å®ƒç”¨äº repo-add çš„å‚æ•°&lt;/a>ã€‚&lt;/p>
&lt;p>ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®ä¸ºè‡ªå·±çš„è½¯ä»¶æºæ·»åŠ  GPG ç­¾åï¼Œä¸ç­¾åçš„è¯ï¼Œpacman.conf ä¸­çš„ä»“åº“é…ç½®éœ€è¦åŠ ä¸Š &lt;code>SigLevel = Never&lt;/code> ç¦ç”¨ç­¾åæ ¡éªŒæ‰èƒ½ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³ä¸ºè‡ªå·±çš„è½¯ä»¶æºæ·»åŠ  GPG ç­¾åçš„è¯ï¼Œå»ºè®®å…ˆç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„ GPG å¯†é’¥å¯¹ï¼ˆä¸è¦è®¾ç½®å¯†ç ï¼‰ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸæœ‰çš„å¯†é’¥å¯¹ï¼Œå¹¶å¯¼å‡ºç§é’¥ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>gpg --gen-key
gpg --armor --export-secret-keys your_keyid &amp;gt; private.key
&lt;/code>&lt;/pre>&lt;p>å›åˆ° GitHub çš„é¡¹ç›®é…ç½®æ–°å¢ Secretsï¼ŒName ä¸º gpg_private_keyï¼ŒValue åˆ™æ˜¯å¯¼å‡ºçš„ç§é’¥å†…å®¹ã€‚æœ€ååœ¨ workflow æ–‡ä»¶çš„ uploadToOneDrive job çš„å‚æ•°åŠ ä¸Š gpg-privatekey: ${{ secrets.gpg_private_key }}ï¼ˆå³ dest_pathã€repo_name ç­‰é…ç½®æ‰€åœ¨çš„ä½ç½®ï¼‰ã€‚ç°åœ¨å¾—åˆ°çš„è½¯ä»¶æºå°†å…·æœ‰ GPG ç­¾åï¼Œéœ€è¦æŒ‰ä»¥ä¸‹æ­¥éª¤å¯¼å…¥å…¬é’¥æ‰èƒ½ä½¿ç”¨ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>gpg --armor --export your_keyid &amp;gt; public.key
sudo pacman-key --add public.key
sudo pacman-key --lsign-key your_keyid
&lt;/code>&lt;/pre>&lt;p>ä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œè¿™ä¸ª job åªä¼šåœ¨ OneDrive å­˜å‚¨æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Œä¸åƒ Arch å®˜æ–¹è½¯ä»¶ä»“åº“é‚£æ ·è¿˜æä¾›äº†å½’æ¡£ã€‚å¦‚æœä½ å¯¹ä½¿ç”¨ Rclone åŒæ­¥åˆ° OneDrive æˆ–æ„å»ºè½¯ä»¶åŒ…æ•°æ®åº“çš„ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆå¯ä»¥æŸ¥çœ‹ &lt;a class="link" href="https://github.com/vifly/arch-build/blob/master/create-db-and-upload-action/entrypoint.sh" target="_blank" rel="noopener"
>entrypoint.sh&lt;/a> è„šæœ¬äº†è§£ç»†èŠ‚ï¼Œä¸åˆ°ä¸‰åè¡Œä¾¿å®Œæˆäº†è¿™äº›å·¥ä½œï¼ˆå…¶å®æ˜¯å› ä¸ºæˆ‘æŠŠå¤æ‚çš„é€»è¾‘ç”¨ Python å®ç°äº†ï¼‰ã€‚&lt;/p>
&lt;h1 id="åœ¨-vercel-éƒ¨ç½²ç›´é“¾ä¸‹è½½åº”ç”¨">åœ¨ Vercel éƒ¨ç½²ç›´é“¾ä¸‹è½½åº”ç”¨
&lt;/h1>&lt;p>ä¸Šé¢æˆ‘ä»¬å·²ç»æŠŠè½¯ä»¶åŒ…æˆåŠŸæ”¾åˆ°äº† OneDrive ä¸­ï¼ŒOneDrive æœ¬èº«ä¹Ÿæœ‰åˆ†äº«åŠŸèƒ½ï¼Œå¯æ˜¯å®ƒçš„åˆ†äº«é“¾æ¥åœ°å€æ²¡æœ‰ä»»ä½•çš„è§„å¾‹ï¼ŒPacman å¯ä¸çŸ¥é“ä¸€ä¸ªè½¯ä»¶åŒ…å¯¹åº”çš„ä¸‹è½½åœ°å€ä¸ OneDrive åˆ†äº«åœ°å€çš„è”ç³»ï¼Œå®ƒåªè®¤ yourrepo.com/package è¿™æ ·çš„ä¸‹è½½åœ°å€ï¼ˆApt ç­‰åŒ…ç®¡ç†å™¨è®¤çš„ URL æ›´å¤æ‚ï¼Œä½†ä¾ç„¶æœ‰æ˜æ˜¾çš„è§„å¾‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåº”ç”¨æ¥å®ç°é“¾æ¥çš„è½¬æ¢ï¼Œè¿™å°±æ˜¯ç›´é“¾ä¸‹è½½åº”ç”¨è¦å¹²çš„äº‹æƒ…ã€‚&lt;/p>
&lt;p>GitHub ä¸Šå·²ç»æœ‰ä¸å°‘ onedrive index é¡¹ç›®å®ç° OneDrive çš„ç›´é“¾ä¸‹è½½ï¼Œæˆ‘å«Œå®ƒä»¬æä¾›çš„åŠŸèƒ½å¤ªå¤šäº†ï¼ˆæ²¡å¿ä½è‡ªé€ è½®å­çš„å†²åŠ¨ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿç”¨ Python é€ äº†ä¸€ä¸ªéå¸¸ç®€é™‹çš„åº”ç”¨ &lt;a class="link" href="https://github.com/vifly/urepo" target="_blank" rel="noopener"
>urepo&lt;/a>ï¼Œæ”¯æŒåœ¨ Vercel ä¸Šéƒ¨ç½²ï¼Œä¹Ÿæ”¯æŒç›´æ¥åœ¨ VPS ä¸Šéƒ¨ç½²ï¼Œå®ƒå’Œ Rclone ä¸€æ ·é‡‡ç”¨äº†å¾®è½¯å®˜æ–¹æä¾›çš„ API å®ç°æå–æ–‡ä»¶ä¸‹è½½é“¾æ¥çš„åŠŸèƒ½ã€‚ä¸‹æ–‡å°†ä½¿ç”¨ urepo å®ç°ç›´é“¾ä¸‹è½½ï¼Œå¦‚æœä½ ä¹‹å‰å·²ç»éƒ¨ç½²äº†å…¶å®ƒçš„ onedrive index åº”ç”¨ï¼Œé‚£å‚ç…§ä¸‹æ–‡ç»§ç»­ç”¨åŸæ¥çš„åº”ç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚&lt;/p>
&lt;h2 id="è·å–è®¿é—®ä»¤ç‰Œ">è·å–è®¿é—®ä»¤ç‰Œ
&lt;/h2>&lt;p>æ—¢ç„¶ urepo å’Œ Rclone ä¸€æ ·é‡‡ç”¨äº†å¾®è½¯å®˜æ–¹æä¾›çš„ APIï¼Œé‚£ä¹ˆå®ƒåŒæ ·ä¹Ÿè¦åƒä½¿ç”¨ Rclone é‚£æ ·è·å–è®¿é—®ä»¤ç‰Œã€‚å›åˆ°ä¸Šé¢çš„â€œåœ¨ Azure åˆ›å»ºåº”ç”¨â€è¿™ä¸€å°èŠ‚ï¼ŒæŒ‰åŒæ ·çš„æ­¥éª¤å†åˆ›å»ºä¸€ä¸ªåº”ç”¨ï¼Œåªæ˜¯è¿™æ¬¡çš„ Redirect URI (optional) åº”è¾“å…¥ http://localhost/ ï¼Œå®Œæˆåå¾—åˆ° client id ä¸ client secretã€‚&lt;/p>
&lt;p>ä¸ä¸Šé¢ä¾é  Rclone è·å– Token ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡åˆ™æ˜¯ä½¿ç”¨ä¸€ä¸ªè„šæœ¬è·å– Tokenï¼Œå®ƒä¸ä¼šåƒ Rclone é‚£æ ·ç”³è¯·å†™å…¥æƒé™ã€‚ä¸‹è½½æˆ‘å†™å¥½çš„&lt;a class="link" href="https://github.com/vifly/urepo/blob/main/client-tools/get_deploy_config.py" target="_blank" rel="noopener"
>è·å– Token è„šæœ¬&lt;/a>ä¸&lt;a class="link" href="https://github.com/vifly/urepo/blob/main/client-tools/config.py.example" target="_blank" rel="noopener"
>é…ç½®ç¤ºä¾‹&lt;/a>ï¼Œå¹¶ç¡®ä¿å·²ç»å®‰è£…äº† Python çš„ Requests åº“ï¼ˆ&lt;code>pacman -S python-requests&lt;/code>ï¼‰ï¼Œç„¶åæŠŠé…ç½®ç¤ºä¾‹ï¼ˆconfig.py.exampleï¼‰é‡å‘½åä¸º config.pyï¼Œå¹¶å¡«å…¥ CLITENT_ID ä¸ CLITENT_SECRETã€‚&lt;/p>
&lt;p>è¿è¡Œè„šæœ¬ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>cd downloadpath
python3 get_deploy_config.py
&lt;/code>&lt;/pre>&lt;p>æ ¹æ®æç¤ºæ“ä½œï¼Œæœ€åå¾—åˆ° code ä¸ refresh_tokenã€‚æ­¤æ—¶æˆ‘ä»¬å·²ç»è·å¾— client idã€client secretã€codeã€refresh_token è¿™å››é¡¹é…ç½®ã€‚è‡³äºä¸‹æ–‡ä¸­éœ€è¦ç”¨åˆ°çš„ pathï¼Œé‚£å°±æ˜¯åœ¨â€œé…ç½® GitHub Actionsâ€è¿™ä¸€å°èŠ‚ä¸­çš„ dest_pathã€‚&lt;/p>
&lt;h2 id="éƒ¨ç½²åˆ°-vercel">éƒ¨ç½²åˆ° Vercel
&lt;/h2>&lt;p>&lt;a class="link" href="https://vercel.com/" target="_blank" rel="noopener"
>Vercel&lt;/a> æ˜¯ä¸€ä¸ªå…è´¹çš„åº”ç”¨éƒ¨ç½²å¹³å°ï¼Œä¸»è¦ç”¨æ¥æµ‹è¯•å’Œéƒ¨ç½² Serverless åº”ç”¨ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥é›¶æˆæœ¬åœ°éƒ¨ç½²ç›´é“¾ä¸‹è½½åº”ç”¨ã€‚Vercel æä¾›äº†ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œä»ä¸‹é¢ä¸¤ç§æ–¹å¼ä»»é€‰å…¶ä¸€æ‰§è¡Œå³å¯ã€‚&lt;/p>
&lt;h3 id="æ‰“å¼€é“¾æ¥éƒ¨ç½²æ¨è">æ‰“å¼€é“¾æ¥éƒ¨ç½²ï¼ˆæ¨èï¼‰
&lt;/h3>&lt;p>æ³¨å†Œæˆ–ç™»å½•ä½ çš„ Vercel è´¦å·ï¼Œç„¶åæ‰“å¼€æˆ‘åˆ›å»ºçš„&lt;a class="link" href="https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fvifly%2Furepo&amp;amp;env=code,path,client_secret,client_id,refresh_token" target="_blank" rel="noopener"
>éƒ¨ç½²é“¾æ¥&lt;/a>ï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œåœ¨ GitHubã€GitLabã€Bitbucket è¿™ä¸‰ä¸ª Git å¹³å°ä¸­é€‰æ‹©ä¸€ä¸ªè¿›è¡Œè¿æ¥ï¼ŒVercel ä¼šæŠŠ urepo ä»“åº“å¤åˆ¶åˆ°è¿æ¥çš„å¹³å°ä¸Šã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/vercel_import_repo.png"
width="1204"
height="893"
loading="lazy"
alt="Vercel å¯¼å…¥ä»“åº“"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="323px"
>&lt;/p>
&lt;p>æ¥ä¸‹æ¥çš„ Create a Team åªè¦ç‚¹å‡» Skip è·³è¿‡å°±è¡Œï¼Œç„¶åå°±æ˜¯ç¯å¢ƒå˜é‡çš„è®¾ç½®ï¼Œurepo ä¼šé¦–å…ˆå°è¯•ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–è¿™äº›ç§å¯†ä¿¡æ¯ï¼Œæ— æ³•æ‰¾åˆ°å¯¹åº”çš„ä¿¡æ¯æ—¶æ‰ä¼šå»è¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ auth.json è·å–é…ç½®ï¼Œä¸æŠŠè®¿é—®ä»¤ç‰Œå†™åœ¨é…ç½®æ–‡ä»¶ç›¸æ¯”ï¼Œåˆ©ç”¨ç¯å¢ƒå˜é‡é…ç½®å¯ä»¥é¿å…è‡ªå·±ä¸å°å¿ƒæŠŠç§å¯†ä¿¡æ¯å…¬å¼€ï¼Œæ ¹æ®ä¸Šæ–‡å¡«å†™è¿™äº”ä¸ªç¯å¢ƒå˜é‡åå°±å®Œæˆéƒ¨ç½²äº†ã€‚&lt;/p>
&lt;h3 id="ä»æœ¬åœ°ä¸Šä¼ éƒ¨ç½²">ä»æœ¬åœ°ä¸Šä¼ éƒ¨ç½²
&lt;/h3>&lt;p>æœ¬æ–¹æ³•éœ€è¦å®‰è£… NodeJS ç›¸å…³çš„å·¥å…·é“¾ï¼Œæˆ‘ä¸å¤ªæƒ³å’Œè¿™äº›å·¥å…·æ‰“äº¤é“ï¼Œä½† Vercel æœ¬æ¥æ˜¯ä¸€ä¸ªéƒ¨ç½²å‰ç«¯åº”ç”¨çš„å¹³å°ï¼Œæ‰€ä»¥å®˜æ–¹çš„å®¢æˆ·ç«¯ä½¿ç”¨ JS ç¼–å†™æ˜¯å¾ˆæ­£å¸¸çš„äº‹æƒ…ï¼Œå¦‚æœä¸æƒ³å®‰è£…è¿™äº›è½¯ä»¶ï¼Œé‚£å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„éƒ¨ç½²æ–¹æ³•ã€‚&lt;/p>
&lt;p>é¦–å…ˆå®‰è£… Yarn æˆ–å…¶å®ƒ NodeJS åŒ…ç®¡ç†å™¨ï¼š&lt;code>pacman -S yarn&lt;/code>ï¼Œç”±äº JS åº”ç”¨æ€»æ˜¯å–œæ¬¢åœ¨ç”¨æˆ·çš„å®¶ç›®å½•ä¹±ä¸¢ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸ºäº†è®© Yarn éµå¾ª&lt;a class="link" href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html" target="_blank" rel="noopener"
> XDG ç›®å½•è§„èŒƒ&lt;/a>ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ &lt;code>yarn config set prefix ~/.local&lt;/code>ã€‚ç„¶åæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å…¨å±€å®‰è£… vercel åº”ç”¨ï¼Œè¿™ä¼šæŠŠå®ƒå®‰è£…åˆ°ä½ çš„å®¶ç›®å½•ï¼ˆ~/.local/binï¼Œè®°å¾—è®©ä½ çš„ $PATH åŒ…å«è¿™ä¸ªè·¯å¾„ï¼‰ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>yarn global add vercel
&lt;/code>&lt;/pre>&lt;p>å®‰è£…å®Œæˆåæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤è¿›è¡Œç™»å½•ï¼Œåœ¨æ‰“å¼€çš„æµè§ˆå™¨çª—å£æ³¨å†Œæˆ–ç™»å½•ä½ çš„ Vercel è´¦å·å¹¶è¿›è¡ŒéªŒè¯ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>vercel login
&lt;/code>&lt;/pre>&lt;p>ä¸‹è½½ urepo æºç ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>git clone git@github.com:vifly/urepo.git
&lt;/code>&lt;/pre>&lt;p>æŠŠ urepo æ ¹ç›®å½•ä¸‹çš„ auth.json.example é‡å‘½åä¸º auth.jsonï¼Œç„¶åæŠŠå¯¹åº”çš„é…ç½®å¡«å…¥é‡Œé¢ã€‚æˆ–è€…ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸Šä¼ éƒ¨ç½²ååˆ° Vercel çš„é¡¹ç›®é¢æ¿ä¸­è®¾ç½® codeã€pathã€client_secretã€client_idã€refresh_token è¿™äº”ä¸ªç¯å¢ƒå˜é‡ã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/vercel_set_env.png"
width="1236"
height="902"
loading="lazy"
alt="Vercel è®¾ç½®ç¯å¢ƒå˜é‡"
class="gallery-image"
data-flex-grow="137"
data-flex-basis="328px"
>&lt;/p>
&lt;p>æœ€åå°±æ˜¯ä¸Šä¼ éƒ¨ç½²ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>cd urepo
vercel .
&lt;/code>&lt;/pre>&lt;h2 id="ä½¿ç”¨è‡ªå·±çš„åŸŸåå¯é€‰">ä½¿ç”¨è‡ªå·±çš„åŸŸåï¼ˆå¯é€‰ï¼‰
&lt;/h2>&lt;p>å°½ç®¡ Vercel ä¼šä¸ºéƒ¨ç½²çš„åº”ç”¨åˆ†é…ä¸€ä¸ªäºŒçº§åŸŸåï¼ˆxxx.vercel.appï¼‰ï¼Œä½†è‡ªå»ºæºä½¿ç”¨è‡ªå·±çš„åŸŸåæ— ç–‘æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚æ ¹æ®&lt;a class="link" href="https://vercel.com/docs/custom-domains#subdomains" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼Œé¦–å…ˆéœ€è¦æ‰“å¼€é¡¹ç›®çš„åŸŸåç®¡ç†ç•Œé¢ï¼Œæ·»åŠ è‡ªå·±æƒ³ä½¿ç”¨çš„åŸŸåã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/vercel_add_domain.png"
width="1319"
height="873"
loading="lazy"
alt="Vercel æ·»åŠ åŸŸå"
class="gallery-image"
data-flex-grow="151"
data-flex-basis="362px"
>&lt;/p>
&lt;p>å‡è®¾å„ä½å’Œæˆ‘ä¸€æ ·ä½¿ç”¨äº†è‡ªå·±çš„å­åŸŸåï¼Œé‚£ä¹ˆåœ¨è‡ªå·±çš„ DNS è§£ææœåŠ¡æä¾›å•†ç®¡ç†é¢æ¿æ·»åŠ ä¸€æ¡ CNAME è§£æè®°å½•å³å¯ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ cloudflareï¼Œè¿˜éœ€è¦æŠŠä»£ç†çŠ¶æ€è®¾ä¸ºâ€œä»…é™ DNSâ€ä»¥ç¡®ä¿ä¸ä¼šä½¿ç”¨ cloudflare çš„åä»£ã€‚&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo/cloudflare_set_vercel_cname.png"
width="1102"
height="154"
loading="lazy"
alt="åœ¨ cloudflare è®¾ç½®æŒ‡å‘ Vercel çš„ CNAME"
class="gallery-image"
data-flex-grow="715"
data-flex-basis="1717px"
>&lt;/p>
&lt;h1 id="æœ‰å¾…æ”¹è¿›çš„åœ°æ–¹">æœ‰å¾…æ”¹è¿›çš„åœ°æ–¹
&lt;/h1>&lt;p>å°½ç®¡è¿™ä¸€æµç¨‹å·²ç»èƒ½å·¥ä½œäº†ï¼Œä½†æœ‰äº›åœ°æ–¹è¿˜æ˜¯å¯ä»¥å†æ”¹è¿›ä¸€ä¸‹çš„ã€‚&lt;del>é¦–å…ˆï¼Œç›®å‰å¹¶æ²¡æœ‰æ•°å­—ç­¾åï¼Œæ·»åŠ è¿™ä¸€è‡ªå»ºè½¯ä»¶æºæ—¶éœ€è¦ç¦ç”¨å¯¹æ­¤çš„ç­¾åæ ¡éªŒï¼Œåœ¨ä¹å®‰å…¨æ€§çš„åŒå­¦å¯èƒ½ä¼šå¯¹æ­¤è¡¨ç¤ºä¸çˆ½ï¼Œæ‰€ä»¥æ—¥åæœ‰å¿…è¦åŠ ä¸Šå¯¹è½¯ä»¶åŒ…ç­¾åçš„æ”¯æŒã€‚å…¶æ¬¡ï¼Œurepo åº”è¯¥æ— éœ€ä¿®æ”¹å°±å¯ä»¥ç”¨äºåˆ†å‘å…¶å®ƒå‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ä¸æ•°æ®åº“ï¼ˆå®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç®€é™‹çš„ onedrive indexï¼‰ï¼Œä½†å‰é¢çš„ GitHub Actions åªæ”¯æŒ Archï¼Œæˆ‘æœªæ¥è‚¯å®šä¼šåŠ ä¸Šå¯¹ Debian/Ubuntu çš„æ”¯æŒï¼Œå…·ä½“ä»€ä¹ˆæ—¶å€™æå®šè¿™ä¸ªï¼Œå°±è¦çœ‹æˆ‘ä»€ä¹ˆæ—¶å€™æœ‰éœ€æ±‚äº†ï¼Œå¯¹å…¶å®ƒå‘è¡Œç‰ˆçš„æ”¯æŒä¹Ÿæ˜¯åŒæ ·çš„ğŸ˜‚&lt;/del>ã€‚ç›®å‰å·²æ”¯æŒ GPG ç­¾åï¼Œä¹Ÿæ–°å¢äº† &lt;a class="link" href="https://github.com/vifly/debian-build" target="_blank" rel="noopener"
>debian-build&lt;/a> ç”¨äºæ„å»º deb è½¯ä»¶åŒ…ã€‚&lt;/p>
&lt;p>å¦å¤–ï¼Œæˆ‘ç¼–å†™çš„ urepo ä¸ GitHub Actions è„šæœ¬çš„æŠ¥é”™ä¿¡æ¯å¹¶ä¸å¤Ÿç”¨æˆ·å‹å¥½ï¼Œç”±äºå¤§é‡é‡‡ç”¨äº† Python è¿›è¡Œç¼–å†™ï¼Œå‡å¦‚å‡ºç°é”™è¯¯çš„è¯å¯¹äºæ²¡å­¦è¿‡ Python çš„åŒå­¦æ¥è¯´å¯èƒ½éš¾ä»¥æ ¹æ®è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯è§£å†³é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯ç•™å¾…æ—¥åè§£å†³ã€‚&lt;/p></description></item><item><title>GitHub Actions æ‰“é€  AUR æ‰“åŒ…ä¸‹è½½ä¸€æ¡é¾™æœåŠ¡</title><link>https://viflythink.com/Use_GitHubActions_to_build_AUR/</link><pubDate>Tue, 28 Apr 2020 00:00:00 +0800</pubDate><guid>https://viflythink.com/Use_GitHubActions_to_build_AUR/</guid><description>&lt;img src="https://viflythink.com/Use_GitHubActions_to_build_AUR/show.png" alt="Featured image of post GitHub Actions æ‰“é€  AUR æ‰“åŒ…ä¸‹è½½ä¸€æ¡é¾™æœåŠ¡" />&lt;p>&lt;em>2021.2.2.æ›´æ–°ï¼šå— &lt;a class="link" href="https://www.aloxaf.com/2020/06/build_aur_with_github_actions/" target="_blank" rel="noopener"
>Aloxaf çš„åšæ–‡&lt;/a>å¯å‘æ–°å¢ä½¿ç”¨è‡ªå·±çš„ PKGBUILD è¿›è¡Œæ„å»ºçš„è¯´æ˜ã€‚&lt;/em>&lt;/p>
&lt;p>å°½ç®¡ç›®å‰åšä¸»æˆ‘è¿˜åœ¨è€ƒç ”ï¼Œä½†æœ€è¿‘è¿˜æ˜¯ç»ä¸ä½æŠ˜è…¾ Arch çš„è¯±æƒ‘ï¼ŒæŠ½ç©ºå¯¹ä½¿ç”¨ Arch ä»¥æ¥ä¸€ç›´è§‰å¾—ä½“éªŒä¸å¤Ÿå¥½çš„å®‰è£… AUR è½¯ä»¶åŒ…æµç¨‹è¿›è¡Œæ”¹é€ ï¼Œæœ€ç»ˆçš„ç»“æœå°±æ˜¯æ­å»ºäº†è¿™ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ AUR ç¼–è¯‘æ‰“åŒ…ä¸‹è½½å®‰è£…ä¸€æ¡é¾™æœåŠ¡ï¼Œå¹¶å†™ä¸‹æœ¬æ–‡å‘å„ä½å®‰åˆ©ã€‚è¦é—®ä¸ºä»€ä¹ˆæˆ‘æƒ³æŠ˜è…¾è¿™ä¸ªä¸œè¥¿ï¼Œå½“ç„¶æ˜¯å› ä¸ºä½¿ç”¨ AUR åŠ©æ‰‹å®‰è£… AUR çš„è½¯ä»¶åŒ…å­˜åœ¨å¦‚ä¸‹ç¼ºç‚¹ï¼š&lt;/p>
&lt;ol>
&lt;li>ä¸‹è½½é€Ÿåº¦æ…¢ï¼Œç”±äºå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦ä» GitHub ä¸‹è½½æ–‡ä»¶ï¼Œæ‰€ä»¥æ¯ç§’ 10 KB çš„ä¸‹è½½é€Ÿåº¦æ˜¯å¾ˆå¸¸è§çš„ï¼ˆè™½ç„¶è¿™ç‚¹å¯ä»¥é€šè¿‡è®¾ç½® http_proxy ç¯å¢ƒå˜é‡è®© Yay ç­‰ AUR åŠ©æ‰‹ä½¿ç”¨ä»£ç†æ¥è§£å†³ï¼‰&lt;/li>
&lt;li>ç¼–è¯‘éœ€è¦æ—¶é—´ï¼Œå¦‚æœä½ åªæ˜¯éœ€è¦å‡ ä¸ªå°è½¯ä»¶åŒ…é‚£å¯ä»¥æ— è§†è¿™ç‚¹&lt;/li>
&lt;li>ç»™åˆ«äººåˆ†äº«å·²æ‰“å¥½çš„è½¯ä»¶åŒ…æœ‰ç‚¹éº»çƒ¦ï¼Œæ¯æ¬¡æ›´æ–°ä½ éƒ½éœ€è¦é€šè¿‡æŸç§æ–¹å¼ä¼ è¾“æ–‡ä»¶ç»™å¯¹æ–¹ï¼ˆå‡‘å¤Ÿä¸‰ç‚¹ ï¼äººâ—•â€¿â€¿â—•äººï¼¼ï¼‰&lt;/li>
&lt;/ol>
&lt;p>ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæœ¬æ–‡ä½¿ç”¨å…è´¹çš„ GitHub Actions ä¸ Cloudflare Workersï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ æ­å»ºä¸€ä¸ªè‡ªåŠ¨åŒ– AUR è½¯ä»¶æ„å»ºæµç¨‹ï¼Œåªéœ€ä¸€æ¬¡é…ç½®ï¼Œä½ å°±å¯ä»¥äº«å—èˆ¹æ–°çš„&lt;del>ç™½å«–&lt;/del> AUR ä½¿ç”¨ä½“éªŒã€‚å¦å¤–ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å®é™…ä½¿ç”¨ CIï¼ˆæŒç»­é›†æˆï¼‰ï¼Œé€šè¿‡é…ç½®æ•´ä¸ªå·¥ä½œæµï¼Œæˆ‘ç®—æ˜¯å­¦ä¹ äº†ä¸€æŠŠ CI çš„ä½¿ç”¨ï¼ˆ&lt;em>PSï¼šè¿™æ‰æ˜¯çœŸæ­£çš„ç›®çš„&lt;/em>ï¼‰ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥æŠŠè¿™ç¯‡æ–‡ç« å½“ä½œæˆ‘çš„ CI å­¦ä¹ ç¬”è®°ã€‚&lt;/p>
&lt;h1 id="github-actions-ç®€ä»‹">GitHub Actions ç®€ä»‹
&lt;/h1>&lt;p>é¦–å…ˆï¼ŒGitHub Actions æ˜¯ GitHub åœ¨ 2019 å¹´æ¨å‡ºçš„ä¸€é¡¹ CI æœåŠ¡ã€‚å¦‚æœä½ æ²¡å¬è¯´è¿‡ CIï¼Œé‚£è¿™é‡Œæˆ‘å°è¯•ç”¨ä¸€å¥è¯æ¥è§£é‡Šï¼ŒCI å°±æ˜¯å¯¹æ–°çš„é¡¹ç›®æ›´æ”¹è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºï¼Œåœ¨æœ¬æ–‡çš„åœºæ™¯ä¸‹ï¼Œæ–°çš„æ›´æ”¹æŒ‡çš„æ˜¯ AUR ä¸Šçš„ PKGBUILD æ–‡ä»¶å‘ç”Ÿå˜æ›´ï¼ˆå®é™…ä¸Šæˆ‘ä¸ºäº†å·æ‡’ï¼Œé€‰æ‹©äº†è®¾ç½®å®šæ—¶ä»»åŠ¡è€Œä¸æ˜¯ç›‘æµ‹ PKGBUILD çš„å˜æ›´ï¼‰ï¼Œè‡ªåŠ¨åŒ–æ„å»ºå°±æ˜¯è‡ªåŠ¨ç¼–è¯‘åŠ æ‰“åŒ…ä»¥åŠä¸Šä¼ ï¼ˆå¦‚æœæ˜¯é—­æºè½¯ä»¶é‚£å°±ä¸æ˜¯ç¼–è¯‘è€Œæ˜¯æ‹†åŒ…ç­‰æ“ä½œï¼‰ã€‚å—¯ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå¦‚æœæƒ³çŸ¥é“ CI çš„è¯¦ç»†å®šä¹‰ï¼Œå¯ä»¥çœ‹ä¸‹&lt;a class="link" href="https://www.redhat.com/zh/topics/devops/what-is-ci-cd" target="_blank" rel="noopener"
>çº¢å¸½çš„æ–‡ç« &lt;/a>ã€‚&lt;/p>
&lt;p>GitHub Actions çš„ç‰¹ç‚¹æ˜¯æ”¯æŒçš„è§¦å‘æ¡ä»¶ç§ç±»æ•°éå¸¸å¤šï¼Œè€Œä¸”ä¸ GitHub çš„é›†æˆå¾ˆå¥½ï¼Œå­¦ä¹ éš¾åº¦ä¹Ÿä¸é«˜ï¼Œåªè¦ç®€å•åœ°å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶å³å¯ï¼Œè¿˜å¯è½»æ¾è°ƒç”¨åˆ«äººå†™å¥½çš„æ“ä½œæ­¥éª¤ï¼Œå¯¹äºå¼€æºé¡¹ç›®ä½œè€…æ¥è¯´æœ€å¤§çš„å¥½å¤„å°±æ˜¯å¯ä»¥ç™½å«– GitHub çš„æœºå™¨ç”¨æ¥ä¸ºä¸åŒçš„å¹³å°ç¼–è¯‘ã€‚å¦‚æœä½ å·²ç»å¯¹ GitHub Actions æ„Ÿåˆ°å¿ƒåŠ¨ï¼Œé‚£ä¹ˆä¸å¦¨é˜…è¯»&lt;a class="link" href="https://help.github.com/en/actions/getting-started-with-github-actions" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>æ¥å­¦ä¹ ä¸€ä¸‹ç”¨æ³•ï¼Œæˆ–è€…é &lt;a class="link" href="https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener"
>é˜®ä¸€å³°çš„ä»‹ç»æ–‡&lt;/a>å¿«é€Ÿä¸Šæ‰‹ã€‚æƒ³è¦æ›´ç®€çŸ­çš„ä»‹ç»ï¼Ÿæ²¡é—®é¢˜ï¼Œæ¥çœ‹çœ‹ä¸‹é¢çš„è®²è§£å§ã€‚&lt;/p>
&lt;p>æƒ³è¦ä½¿ç”¨ GitHub Actionsï¼Œé‚£é¦–å…ˆéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ .github/workflows æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ yml ä¸ºåç¼€åçš„ workflow æ–‡ä»¶ï¼ˆå¦‚ build.ymlï¼‰ï¼Œåœ¨è¿™ä¸ª YAML æ–‡ä»¶ä¸­å†™å…¥æˆ‘ä»¬çš„é…ç½®ã€‚é‚£ä¹ˆé…ç½®è¯¥æ€ä¹ˆå†™å‘¢ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Greeting from Mona&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">push&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># ================== ç¬¬ä¸€ä¸ª jobï¼Œè¿™åªæœ‰ä¸€ä¸ª job ==================&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">my-job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">My Job&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ================== ç¬¬ä¸€ä¸ª stepï¼Œæ‰§è¡Œå•ä¸ªå‘½ä»¤ ==================&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Print a greeting&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MY_VAR&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Hi there! My name is&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">FIRST_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Mona&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">MIDDLE_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">The&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">LAST_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Octocat&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">echo $MY_VAR $FIRST_NAME $MIDDLE_NAME $LAST_NAME.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ================== ç¬¬äºŒä¸ª stepï¼Œä½¿ç”¨åˆ«äººçš„ action ==================&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># ================== ç¬¬ä¸‰ä¸ª stepï¼Œæ‰§è¡Œå¤šä¸ªå‘½ä»¤ ==================&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Install the dependencies&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> sudo apt-get update
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> sudo apt-get install pkg-config gettext&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŒ‰ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºæ¥çœ‹ï¼Œname å¯¹è±¡åº”è¯¥æ— éœ€è§£é‡Šäº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ &lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#on" target="_blank" rel="noopener"
>on&lt;/a> å¯¹è±¡ï¼Œå¯ä»¥å¡«å…¥å•ä¸ªäº‹ä»¶æˆ–äº‹ä»¶æ•°ç»„ä½œä¸ºè§¦å‘æ¡ä»¶ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶ä¾¿æ‰§è¡Œè¿™ä¸ª YAML æ–‡ä»¶é‡Œçš„å†…å®¹ï¼ˆä¸€ä¸ªé¡¹ç›®å¯ä»¥å­˜åœ¨å¤šä¸ª workflow æ–‡ä»¶ï¼‰ï¼Œåœ¨ç¤ºä¾‹ä¸­çš„ push æŒ‡çš„æ˜¯ git pushï¼Œå³æ¯æ¬¡æ¨é€ä»£ç éƒ½ä¼šè§¦å‘è¿™ä¸ª workflowï¼Œå®Œæ•´çš„äº‹ä»¶æ”¯æŒåˆ—è¡¨å¯é€šè¿‡&lt;a class="link" href="https://help.github.com/en/articles/events-that-trigger-workflows" target="_blank" rel="noopener"
>å®˜æ–¹æ–‡æ¡£&lt;/a>è·çŸ¥ã€‚&lt;/p>
&lt;p>æ¥ä¸‹æ¥å°±æ˜¯ jobs äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ªåä¸º my-job çš„ jobï¼Œä¸€èˆ¬è€Œè¨€ jobs æ˜¯ workflow æ–‡ä»¶çš„ä¸»ä½“ï¼Œä¸€ä¸ª job ç”±è‹¥å¹²ä¸ª step ç»„æˆï¼Œè¿™äº› step ä¼šæŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œæˆ‘ç”¨åˆ†å‰²çº¿å°†å„ä¸ª step åˆ†å¼€äº†ã€‚&lt;/p>
&lt;p>åœ¨è§£é‡Š step å‰æˆ‘ä»¬ä¸å¦¨å…ˆçœ‹ä¸‹æ¯ä¸€ä¸ª job ä¸­éƒ½è¦å¡«å†™çš„ &lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on" target="_blank" rel="noopener"
>runs-on&lt;/a> å¯¹è±¡ï¼Œå®ƒæŒ‡å®šäº†è¯¥ job çš„å·¥ä½œç³»ç»Ÿç¯å¢ƒï¼Œç›®å‰å¯é€‰çš„ç³»ç»Ÿæœ‰ windows-latestã€ubuntu-latestã€ubuntu-16.04ã€macos-latestï¼Œè¿™è¦†ç›–äº†ä¸»æµçš„æ“ä½œç³»ç»Ÿå¹³å°ï¼Œä¸ºä¸åŒå¹³å°çš„ç¼–è¯‘æä¾›äº†ä¾¿åˆ©ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå°±æ˜¯æ¯ä¸ª job ä¸­å¿…é¡»å­˜åœ¨çš„ step äº†ï¼Œæ¯ä¸ª step éƒ½ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„æ“ä½œæ­¥éª¤ï¼Œæ—¢å¯ä»¥åœ¨ &lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsrun" target="_blank" rel="noopener"
>run&lt;/a> å¯¹è±¡å†…å¡«å…¥ä½ éœ€è¦æ‰§è¡Œçš„ Shell å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨ &lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsuses" target="_blank" rel="noopener"
>uses&lt;/a> å¯¹è±¡é‡Œå¡«å…¥å¯¹åº”çš„é…ç½®ä»¥ä½¿ç”¨åˆ«äººçš„ actionï¼ˆåœ¨ &lt;a class="link" href="https://github.com/marketplace?type=actions" target="_blank" rel="noopener"
>Marketplace&lt;/a> ä¸­æµè§ˆå…¨éƒ¨ actionï¼‰ã€‚&lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstepsenv" target="_blank" rel="noopener"
>env&lt;/a> å¯¹è±¡ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªå¯¹è±¡å­˜åœ¨ä¸€ä¸ªéå¸¸æœ‰è¶£çš„åº”ç”¨åœºæ™¯ï¼šå¦‚æœä½ çš„ step éœ€è¦ä½¿ç”¨ä¸å®œå…¬å¼€çš„ Tokenï¼Œé‚£ä½ å¯ä»¥&lt;a class="link" href="https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets" target="_blank" rel="noopener"
>åœ¨é¡¹ç›®è®¾ç½®ä¸­è®¾ç½®è¯¥ Token&lt;/a>ï¼Œç„¶ååœ¨ env å¯¹è±¡ä¸­ä½¿ç”¨ super_secret: $ å°†è¿™ä¸ª Token è®¾ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶åœ¨è‡ªå·±çš„ step ä¸­è¯»å–è¯¥ç¯å¢ƒå˜é‡ä»¥å–å¾— Tokenï¼Œè¿™æ ·å°±èƒ½é¿å…åœ¨ workflow æ–‡ä»¶ä¸­ç¡¬ç¼–ç  Tokenã€‚å½“ä½ å†æ¬¡çœ‹åˆ° $ è¿™æ ·çš„å˜é‡æ—¶ï¼Œä½ å°±åº”è¯¥æ˜ç™½è¿™æ˜¯ä¸€ä¸ªç§å¯†å˜é‡ï¼Œæ˜¯ä¸èƒ½å…¬å¼€çš„ã€‚&lt;/p>
&lt;h1 id="å¼€å§‹æ„é€ æ‰“åŒ…å·¥ä½œæµ">å¼€å§‹æ„é€ æ‰“åŒ…å·¥ä½œæµ
&lt;/h1>&lt;p>ç»è¿‡ä¸Šæ–‡çš„ä»‹ç»ï¼Œå„ä½åº”è¯¥å¯¹ GitHub Actions æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬å¼€å§‹ç™½å«– GitHub Actions å§ã€‚æ³¨æ„ï¼Œæœ¬èŠ‚ä¸­çš„è¯´æ˜å‡ä¸æœ€æ–°ç‰ˆæœ¬çš„ &lt;a class="link" href="https://github.com/vifly/arch-build" target="_blank" rel="noopener"
>arch-build&lt;/a> å­˜åœ¨å·®å¼‚ï¼Œä»…ç”¨ä½œæè¿°æ€è·¯ï¼Œæƒ³è¦æŠ„ä½œä¸šçš„è¯·ç›´æ¥è·³åˆ°â€œæœ€ç»ˆæˆå“ä¸é…ç½®â€ä¸€èŠ‚ã€‚&lt;/p>
&lt;h2 id="è‡ªåŠ¨ç¼–è¯‘-aur-çš„è½¯ä»¶åŒ…">è‡ªåŠ¨ç¼–è¯‘ AUR çš„è½¯ä»¶åŒ…
&lt;/h2>&lt;p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨ Arch Linux ä¸Šæ„å»º AUR ä¸Šçš„è½¯ä»¶åŒ…ï¼Œä½†æ˜¯ä¸Šæ–‡æåˆ°çš„ runs-on å¯¹è±¡å¯ä»¥å¡«å…¥çš„ç³»ç»Ÿå¹¶ä¸åŒ…æ‹¬ Archï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨åŸºäº Arch çš„å®¹å™¨ï¼Œåœ¨å®¹å™¨å†…æ„å»ºã€‚è¿™é‡Œè¦æ„Ÿè°¢ &lt;a class="link" href="https://github.com/Qv2ray/Qv2ray" target="_blank" rel="noopener"
>Qv2ray&lt;/a> çš„ä¸€ä½å¼€å‘è€… &lt;a class="link" href="https://www.ducksoft.site/" target="_blank" rel="noopener"
>DuckSoft&lt;/a> æä¾›äº†è¿™ä¸ªæ€è·¯ï¼Œè€Œä¸”ç¼–å†™äº† &lt;a class="link" href="https://github.com/DuckSoft/build-aur-action" target="_blank" rel="noopener"
>build-aur-action&lt;/a> è¿™ä¸ª action ç”¨æ¥ç¼–è¯‘æ‰“åŒ… AUR ä¸Šçš„è½¯ä»¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•è‡ªåŠ¨è¿›è¡Œç¼–è¯‘ï¼Œä» CI çš„æ­£å¸¸ä½¿ç”¨æ–¹å¼æ¥è¯´ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ on å¯¹è±¡ä¸­è®¾å®šè¿™æ ·ä¸€ä¸ªè§¦å‘æ¡ä»¶ï¼šå½“ AUR ç‰¹å®šçš„è½¯ä»¶åŒ…æ›´æ–°æ—¶è‡ªåŠ¨è¿›è¡Œç¼–è¯‘ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ¡ˆè¿˜éœ€è¦å†™æ£€æµ‹æ›´æ–°çš„ä»£ç ï¼Œä¸ºäº†å·æ‡’ï¼Œæˆ‘é€‰æ‹©è®¾ç½®å®šæ—¶ä»»åŠ¡æ¥ç¼–è¯‘ï¼Œç”±äº on å¯¹è±¡æ”¯æŒ&lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#onschedule" target="_blank" rel="noopener"
>é€šè¿‡ Cron è¯­æ³•è®¾å®šå®šæ—¶ä»»åŠ¡&lt;/a>ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜èƒ½è¢«è½»æ¾è§£å†³ã€‚å°±è¿™æ ·ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªç®€å•çš„ workflow æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">BUILD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">schedule&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">cron&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;1 */8 * * *&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DuckSoft/build-aur-action@master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">repo-name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">osu-lazer&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æé†’ä¸€ä¸‹ï¼Œä½¿ç”¨åˆ«äººçš„ action æ—¶å¯èƒ½éœ€è¦ä½¿ç”¨ with å¯¹è±¡è¾“å…¥ä¸€äº›å˜é‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è¾“å…¥çš„å°±æ˜¯æƒ³è¦æ„å»ºçš„ AUR è½¯ä»¶çš„è½¯ä»¶åŒ…åã€‚&lt;/p>
&lt;h2 id="ä¸Šä¼ åˆ°-github-releases">ä¸Šä¼ åˆ° GitHub Releases
&lt;/h2>&lt;p>åœ¨ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬å·²æˆåŠŸåœ°æ„å»ºäº†æƒ³è¦çš„è½¯ä»¶åŒ…ï¼Œæ¥ä¸‹æ¥éœ€è¦è§£å†³çš„å°±æ˜¯å¦‚ä½•æŠŠè½¯ä»¶åŒ…å–å‡ºæ¥è¿™ä¸ªé—®é¢˜äº†ã€‚æœ€å¥½çš„è§£å†³æ–¹æ¡ˆè«è¿‡äºå°†æ„å»ºå‡ºæ¥çš„è½¯ä»¶åŒ…ä¸Šä¼ åˆ° Releasesï¼ŒGitHub å®˜æ–¹æä¾›äº† &lt;a class="link" href="https://github.com/actions/upload-release-asset" target="_blank" rel="noopener"
>upload-release-asset&lt;/a> æ¥å®Œæˆè¿™ä¸ªæ“ä½œï¼Œä½†æˆ‘çœ‹äº†è¯´æ˜æ–‡æ¡£åè§‰å¾—è¿™ä¸ªå¤ªéº»çƒ¦äº†ï¼Œå®ƒä¸æ”¯æŒé€šè¿‡ Unix ç»ˆç«¯è§„åˆ™ï¼ˆä¾‹å¦‚ â€œ*.zstâ€ï¼‰ç­›é€‰è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œè€Œä¸”éœ€è¦å…ˆåˆ›å»º Releases åæ‰èƒ½ä¸Šä¼ æ–‡ä»¶ã€‚ç»è¿‡ä¸€ç•ªè°·æ­Œï¼Œæˆ‘æ‰¾åˆ°äº† &lt;a class="link" href="https://github.com/ncipollo/release-action" target="_blank" rel="noopener"
>release-action&lt;/a> è¿™ä¸ªæ›¿ä»£å“ï¼Œä¸ upload-release-asset ç›¸æ¯”ï¼Œè¿™ä¸ª action çš„é…ç½®æ˜æ˜¾æ›´ç®€å•ï¼Œä»ä¸‹é¢è¿™æ®µé…ç½®å³å¯çœ‹å¾—å‡ºæ¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ncipollo/release-action@v1.7.3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">allowUpdates&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tag&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;packages&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">artifacts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;./*/*.zst&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.GITHUB_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŠŠè¿™æ®µé…ç½®æ·»åŠ åˆ° workflow ä¸­ï¼Œç„¶åæˆ‘ä»¬å…ˆçœ‹çœ‹ with å¯¹è±¡ä¸­è¾“å…¥çš„å˜é‡ã€‚token æ˜¯ä¸Šä¼ æ–‡ä»¶åˆ° Releases æ—¶å¿…éœ€çš„ä¸€é¡¹å˜é‡ï¼Œä»å®ƒçš„å½¢å¼å°±å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªç§å¯†å˜é‡ï¼Œä¸è¿‡è¿™ä¸ªç§å¯†å˜é‡æ˜¯å†…ç½®çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨é¡¹ç›®ä¸­æ‰‹åŠ¨è®¾ç½®è¿™ä¸ªå˜é‡ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼›æ¥ç€å°±æ˜¯ tag äº†ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬åœ¨ä»“åº“çš„ Releases é¡µé¢åˆ›å»ºä¸€ä¸ª tagï¼Œç„¶åå°† tag çš„åå­—å¡«å…¥å…¶ä¸­ã€‚å®Œæˆé…ç½®åè¿™ä¸ª action å°±ä¼šæŠŠæ„å»ºçš„è½¯ä»¶åŒ…ä¸Šä¼ åˆ°æŒ‡å®š tag ä¸‹çš„ Releasesï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸‹è½½è¯¥è½¯ä»¶åŒ…äº†ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨-matrix-è¿›è¡Œæ”¹è¿›">ä½¿ç”¨ matrix è¿›è¡Œæ”¹è¿›
&lt;/h2>&lt;p>è™½ç„¶ç›®å‰æˆ‘ä»¬çš„ workflow å·²ç»èƒ½ç”¨äº†ï¼Œä½†æ˜¯éœ€è¦ç¼–è¯‘å¤šä¸ª AUR çš„è½¯ä»¶æ—¶éœ€è¦å¤šæ¬¡å¤åˆ¶ç²˜è´´ä¸Šé¢çš„ stepï¼Œè¿™å¯å¤ªéš¾çœ‹äº†ï¼Œæ˜¯å¦å­˜åœ¨æ›´ä¼˜é›…çš„æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œç» DuckSoft çš„æé†’ï¼Œå¯ä»¥ä½¿ç”¨ &lt;a class="link" href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idstrategymatrix" target="_blank" rel="noopener"
>matrix&lt;/a>ï¼Œå®ƒåŸºäºå•ä¸ª job ä¸­å®šä¹‰çš„ steps å¹¶è¡Œè¿è¡Œå¤šä¸ª jobï¼Œå¤šä¸ª job ä¹‹é—´çš„å·®å¼‚å°±æ˜¯ç‰¹å®šå˜é‡çš„å·®å¼‚ï¼Œè¿™äº›å˜é‡ä»¥æ•°ç»„çš„å½¢å¼å­˜åœ¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œmatrix çš„ç”¨å¤„å°±æ˜¯ä¸ºä¸åŒå¹³å°é‡‡å–åŒæ ·çš„æ­¥éª¤è¿›è¡Œæ„å»ºï¼Œåœ¨æœ¬æ–‡çš„åœºæ™¯ä¸‹å°±æ˜¯é‡‡ç”¨åŒæ ·çš„æ­¥éª¤æ„å»ºä¸åŒçš„ AUR è½¯ä»¶ã€‚è™½ç„¶å¬ç€æœ‰ç‚¹æŠ½è±¡ï¼Œä½†çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ä½ å°±åº”è¯¥èƒ½æ˜ç™½äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-YAML" data-lang="YAML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matrix&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">repos&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="l">osu-lazer, mpv-mpris]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">fail-fast&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DuckSoft/build-aur-action@master&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">repo-name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ matrix.repos }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸ä¹‹å‰çš„ workflow ä¸åŒï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºäº† repos æ•°ç»„ï¼Œå¹¶åœ¨å…¶ä¸­å¡«å…¥éœ€è¦æ„å»ºçš„è½¯ä»¶åã€‚å¦‚æœä¸æŠŠ fail-fast è®¾ç½®ä¸º falseï¼Œåœ¨å¹¶è¡Œ job ä¸­å‡ºç°ä¸€ä¸ªè¿è¡Œå¤±è´¥çš„ job æ—¶ä¼šå¯¼è‡´å…¶å®ƒçš„ job è¢«ç»ˆæ­¢ã€‚å¦å¤–ï¼Œä½¿ç”¨ build-aur-action æ—¶æˆ‘ä»¬æ²¡æœ‰ç›´æ¥è¾“å…¥ repo-nameï¼Œè€Œæ˜¯ä»¥ $ çš„å½¢å¼è¾“å…¥ï¼Œæ•°ç»„ä¸­çš„å˜é‡ä¼šè‡ªåŠ¨åº”ç”¨åˆ°å¯¹åº”çš„ job ä¸­ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨è‡ªå·±çš„-pkgbuildå¯é€‰">ä½¿ç”¨è‡ªå·±çš„ PKGBUILDï¼ˆå¯é€‰ï¼‰
&lt;/h2>&lt;p>ä¸Šè¿°ç‰ˆæœ¬å·²ç»å¾ˆå®Œç¾äº†ï¼Œä¸è¿‡è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘éœ€è¦çš„æŸä¸ªè½¯ä»¶åŒ…è™½ç„¶åœ¨ AUR ä¸­å­˜åœ¨ï¼Œä½†å¯¹åº”çš„ PKGBUILD å†™çš„å¤ªçƒ‚äº†/æ— æ³•æ„å»ºæˆåŠŸï¼Œæ­¤æ—¶æˆ‘å†™äº†ä¸€ä¸ª PKGBUILDï¼Œå¸Œæœ›èƒ½ç™½å«– GitHub Actions è¿›è¡Œæ„å»ºï¼Œè¯¥æ€ä¹ˆåŠå‘¢ã€‚è¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯æ—©æœ‰äººæƒ³åˆ°äº†ï¼Œåªéœ€ä½¿ç”¨ &lt;a class="link" href="https://github.com/edlanglois/pkgbuild-action" target="_blank" rel="noopener"
>pkgbuild-action&lt;/a> å°±å¯è§£å†³ï¼Œå®ƒè¿˜å¯ä»¥è§£å†³æ‰“çš„åŒ…è¿˜ä¾èµ–äº†å…¶å®ƒçš„ AUR åŒ…çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€ä¸ª jobï¼Œcheckout ç›®å‰ä»“åº“è·å– PKGBUILDï¼Œç„¶åä½¿ç”¨ pkgbuild-action è¿›è¡Œæ„å»ºï¼Œéœ€è¦çš„ pkgdir å‚æ•°å°±æ˜¯ PKGBUILD æ‰€åœ¨çš„è·¯å¾„ï¼ˆçˆ¶æ–‡ä»¶å¤¹ï¼‰ï¼Œæœ€åä¾ç„¶æ˜¯ä½¿ç”¨ release-action æ ¹æ® pkgbuild-action è¿”å›çš„æ„å»ºäº§ç‰©è·¯å¾„å°†å…¶ä¸Šä¼ åˆ° GitHub Releasesã€‚&lt;/p>
&lt;h1 id="æœ€ç»ˆæˆå“ä¸é…ç½®">æœ€ç»ˆæˆå“ä¸é…ç½®
&lt;/h1>&lt;p>æœ€ç»ˆç‰ˆçš„ workflow å¯ä»¥åœ¨&lt;a class="link" href="https://github.com/vifly/arch-build/blob/master/.github/workflows/build.yml" target="_blank" rel="noopener"
>è¿™&lt;/a>æŸ¥çœ‹ï¼Œåªéœ€ fork &lt;a class="link" href="https://github.com/vifly/arch-build" target="_blank" rel="noopener"
>arch-build&lt;/a>ï¼Œç„¶åæŒ‰ä¸‹é¢çš„è¯´æ˜ä¿®æ”¹ä¸€ä¸‹ workflow æ–‡ä»¶å³å¯é£Ÿç”¨ã€‚æ³¨æ„ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„æ”¹è¿›ï¼Œæœ€ç»ˆç‰ˆçš„é…ç½®å·²ä¸ä¸Šæ–‡å­˜åœ¨ä¸€å®šåŒºåˆ«ï¼Œå…¶ä¸­çš„ uploadToOneDrive æ˜¯&lt;a class="link" href="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo" target="_blank" rel="noopener"
>ã€Šä½¿ç”¨ Vercel ä¸ OneDrive è‡ªå»ºè½¯ä»¶æºã€‹&lt;/a>ä¸­æ‰€éœ€çš„ jobï¼Œå¦‚æœä½ ä¸éœ€è¦å»ºç«‹ä¸€ä¸ªå¯å…¬å…±è®¿é—®çš„è½¯ä»¶æºè¯·åˆ æ‰å®ƒã€‚&lt;/p>
&lt;p>å¦‚æœåªæ˜¯éœ€è¦æ„å»ºä¸Šä¼  AUR åŒ…ï¼Œé‚£åªéœ€ä¿®æ”¹ buildAUR è¿™ä¸ª job ä¸­çš„å†…å®¹ï¼Œæ ¹æ®è‡ªå·±çš„éœ€è¦ä¿®æ”¹å…¶ matrix å†…çš„è½¯ä»¶åŒ…åï¼ŒbuildNonAUR çš„å†…å®¹åˆ™å¯ä»¥åˆ æ‰ã€‚&lt;/p>
&lt;p>å¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„ PKGBUILD è¿›è¡Œæ„å»ºï¼Œé‚£è¿˜éœ€è¦ä¿®æ”¹ buildNonAUR è¿™ä¸ª jobï¼Œä¾ç„¶éœ€è¦ä¿®æ”¹å…¶ matrix å†…çš„è½¯ä»¶åŒ…åï¼Œå¦å¤–è¿˜éœ€è¦åœ¨ä»“åº“çš„æ ¹ç›®å½•ä¸‹æ–°å»ºä»¥è½¯ä»¶åŒ…åå‘½åçš„æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å­˜æ”¾å¯¹åº”çš„ PKGBUILD æ–‡ä»¶å’Œå…¶å®ƒæ„å»ºè¿‡ç¨‹ä¸­æ‰€éœ€çš„èµ„æºæ–‡ä»¶ã€‚ç»è¿‡æˆ‘çš„ä¿®æ”¹åçš„ pkgbuild-action è¿˜æ”¯æŒä¸€ä¸ªæ–°åŠŸèƒ½ï¼šå¦‚æœæƒ³æ„å»ºçš„è½¯ä»¶åŒ…ä¾èµ–æŸä¸ª AUR è½¯ä»¶åŒ…è€Œä½ ä¸æƒ³ä½¿ç”¨ AUR ä¸Šçš„ PKGBUILDï¼Œé‚£ä¹ˆä½ å¯ä»¥æ–°å»ºä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­æ”¾å…¥è‡ªå·±çš„ PKGBUILDã€‚ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>â”œâ”€â”€ foo
â”‚Â Â  â”œâ”€â”€ PKGBUILD
â”‚Â Â  â””â”€â”€ bar (dependences of foo)
â”‚Â Â  â”œâ”€â”€ PKGBUILD
â”‚Â Â  â””â”€â”€ baz (dependences of bar)
â”‚Â Â  â””â”€â”€ PKGBUILD
&lt;/code>&lt;/pre>&lt;p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå€ŸåŠ© GitHub Actionsï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ª 24 å°æ—¶å¯ç”¨çš„ç¼–è¯‘æœºä»¥åŠå…¬å¼€çš„è½¯ä»¶åŒ…å­˜å‚¨åº“ï¼Œè§£å†³äº†æœ¬æ–‡å¼€å§‹æåˆ°çš„ç¬¬äºŒä¸ç¬¬ä¸‰ç‚¹é—®é¢˜ã€‚è¿™äº›éƒ½æ˜¯å…¨è‡ªåŠ¨ä¸”å…è´¹çš„ï¼Œä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•è®©å®‰è£…è½¯ä»¶åŒ…ä¹Ÿå®ç°è‡ªåŠ¨åŒ–ã€‚&lt;/p>
&lt;h1 id="ç®€å•çš„è‡ªåŠ¨æ›´æ–°ä»“åº“">ç®€å•çš„è‡ªåŠ¨æ›´æ–°ä»“åº“
&lt;/h1>&lt;p>æ‰“å¼€æµè§ˆå™¨ï¼Œä» Releases é¡µé¢ä¸‹è½½è½¯ä»¶åŒ…ï¼Œç„¶åæ‰§è¡Œ pacman -U xxx.pkg.tar.zst å®‰è£…è½¯ä»¶åŒ…ï¼Œè¿™äº›æ“ä½œå®åœ¨å¤ªéº»çƒ¦äº†ï¼Œä¸ºä½•ä¸å»ºç«‹ä¸€ä¸ªè½¯ä»¶æºï¼Œä»¤æ¯æ¬¡æ‰§è¡Œ pacman -Syu æ—¶è‡ªåŠ¨å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„è½¯ä»¶å‘¢ã€‚è‡ªå»ºè½¯ä»¶æºå¬ä¸Šå»ååˆ†é«˜å¤§ä¸Šï¼Œä½†å…¶å®åªæ˜¯å»ºç«‹ä¸€ä¸ªæœ¬åœ°è½¯ä»¶æºå¹¶ä¸éš¾ï¼Œ&lt;a class="link" href="https://wiki.archlinux.org/index.php/Pacman/Tips_and_tricks#Custom_local_repository" target="_blank" rel="noopener"
>Arch WiKi å‡ æ®µæ–‡å­—&lt;/a>ä¾¿è¯´æ˜ç™½äº†ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³å»ºç«‹ä¸€ä¸ªåœ¨çº¿çš„å…¬ç”¨è½¯ä»¶æºä¼šéº»çƒ¦ä¸€äº›ï¼Œæ‰€ä»¥è¿™é‡Œåªè¯´æ˜å¦‚ä½•å»ºç«‹ä¸€ä¸ªè‡ªåŠ¨æ›´æ–°çš„æœ¬åœ°è½¯ä»¶æºã€‚æƒ³è¦å»ºç«‹å…¬ç”¨è½¯ä»¶æºçš„è¯è¯·è·³è¿‡ä¸‹æ–‡ï¼Œé˜…è¯»æˆ‘çš„æ–°åšæ–‡&lt;a class="link" href="https://viflythink.com/Use_Vercel_and_OneDrive_to_setup_your_repo" target="_blank" rel="noopener"
>ã€Šä½¿ç”¨ Vercel ä¸ OneDrive è‡ªå»ºè½¯ä»¶æºã€‹&lt;/a>ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬">ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬
&lt;/h2>&lt;p>ä½œä¸ºä¸€ä¸ªçˆ±å·æ‡’çš„äººï¼Œæˆ‘è‚¯å®šå¸Œæœ›èƒ½è‡ªåŠ¨åŒ–ä¸‹è½½è½¯ä»¶åŒ…ä¸æ›´æ–°è½¯ä»¶ä»“åº“çš„æ“ä½œï¼Œä¸ºæ­¤æˆ‘å†™äº†ä¸€ä¸ªè„šæœ¬æ¥å®Œæˆè¿™äº›äº‹æƒ…ï¼Œå„ä½åªéœ€æ‰“å¼€&lt;a class="link" href="https://github.com/vifly/helper" target="_blank" rel="noopener"
>é¡¹ç›®åœ°å€&lt;/a>ï¼Œä¸‹è½½ä»£ç å¹¶æ ¹æ®è¯´æ˜è¿›è¡Œæ“ä½œå³å¯ã€‚æˆ‘åœ¨è¿™é‡Œè¯´æ˜ä¸€ä¸‹ conf.py çš„é…ç½®ï¼šUserName å’Œ GitHubRepoName å¹¶ä¸éš¾ç†è§£ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘çš„ç™½å«–ä»“åº“åœ°å€æ˜¯ &lt;a class="link" href="https://github.com/vifly/arch-build" target="_blank" rel="noopener"
>https://github.com/vifly/arch-build&lt;/a> ï¼Œé‚£ä¹ˆéœ€è¦å¡«å†™çš„ UserName ä¾¿æ˜¯ viflyï¼ŒGitHubRepoName åˆ™æ˜¯ arch-buildï¼›ProxyURL åœ¨ä¸‹ä¸€å°èŠ‚ä¼šæåˆ°ï¼Œè¿™é‡Œå…ˆä¸è¯´ï¼›DownloadPath æ˜¯ä» Releases ä¸‹è½½çš„è½¯ä»¶åŒ…çš„å­˜å‚¨è·¯å¾„ï¼›æœ«å°¾çš„ ArchRepoDBPath å’Œ ArchRepoName æ˜¯ç”¨äºç”Ÿæˆæœ¬åœ°è½¯ä»¶æºçš„æ•°æ®åº“çš„ï¼Œè„šæœ¬ä¼šè°ƒç”¨ repo-add æ ¹æ® DownloadPath ä¸­çš„è½¯ä»¶åŒ…ç”Ÿæˆè·¯å¾„ä¸º ArchRepoDBPath/ArchRepoName.db.tar.gz çš„æ•°æ®åº“ã€‚&lt;br>
å½“ä½ æˆåŠŸè¿è¡Œè„šæœ¬å»ºç«‹äº†ä¸€ä¸ªæœ¬åœ°è½¯ä»¶æºåï¼Œè¿˜éœ€è¦ä¿®æ”¹ /etc/pacman.conf æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ ä»¥ä¸‹é…ç½®ä»¥è®© Pacman åŒæ­¥ä½ çš„è½¯ä»¶æºçš„æ•°æ®åº“ï¼ˆè‡ªè¡Œæ›¿æ¢ ArchRepoName ä¸ ArchRepoDBPathï¼‰ï¼š&lt;/p>
&lt;pre>&lt;code>[ArchRepoName]
SigLevel = Optional TrustAll
Server = file://ArchRepoDBPath
&lt;/code>&lt;/pre>
&lt;p>å¦å¤–ï¼Œä¸ºäº†è®©æœ¬åœ°çš„è½¯ä»¶ä»“åº“ä¿æŒæœ€æ–°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;a class="link" href="https://wiki.archlinux.org/index.php/cron" target="_blank" rel="noopener"
>Cron&lt;/a> è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è‡ªåŠ¨è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå®Œå…¨å…è´¹ã€è‡ªåŠ¨æ›´æ–°çš„ä¸ªäººè½¯ä»¶ä»“åº“ï¼Œå¿«æ‰§è¡Œ pacman -Syu å¼€å§‹äº«å—ç™½å«–çš„å¿«ä¹å§ã€‚&lt;/p>
&lt;h2 id="ä½¿ç”¨-cloudflare-workers-åä»£åŠ é€Ÿä¸‹è½½å¯é€‰">ä½¿ç”¨ Cloudflare Workers åä»£åŠ é€Ÿä¸‹è½½ï¼ˆå¯é€‰ï¼‰
&lt;/h2>&lt;p>ä¸ºäº†è§£å†³åœ¨å›½å†… GitHub ä¸‹è½½é€Ÿåº¦æ…¢çš„é—®é¢˜ï¼Œè®©æˆ‘ä»¬ç»§ç»­å‘æ‰¬ç™½å«–çš„ç²¾ç¥ï¼Œä½¿ç”¨ &lt;a class="link" href="https://workers.cloudflare.com/" target="_blank" rel="noopener"
>Cloudflare Workers&lt;/a>ï¼ˆä¸éœ€è¦æ‹¥æœ‰åŸŸåï¼‰ æ¥åŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚å¹¿å¤§ç™½å«–å…šæ—©å·²å‘ç°å¯ä»¥ä½¿ç”¨å…è´¹çš„ Cloudflare Workers éƒ¨ç½² serverless åº”ç”¨åä»£å›½å†…æ— æ³•è®¿é—®çš„ç½‘ç»œèµ„æºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨è¿™ç§æ–¹å¼åŠ é€Ÿä¸‹è½½ã€‚åˆšå¼€å§‹æ—¶æˆ‘ä½¿ç”¨äº† &lt;a class="link" href="https://github.com/hunshcn/gh-proxy" target="_blank" rel="noopener"
>gh-proxy&lt;/a> è¿™ä¸ªåŠ é€Ÿ GitHub ä¸‹è½½çš„é¡¹ç›®ï¼Œä¸è¿‡åæ¥ Arch ç¾¤çš„ &lt;a class="link" href="https://nichi.co/" target="_blank" rel="noopener"
>NickCao&lt;/a> åŒå­¦æ¨èäº†ä»–å†™çš„æ›´é€šç”¨çš„åä»£åº”ç”¨ï¼Œæ„Ÿè°¢ NickCaoï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¼€å§‹éƒ¨ç½²åä»£åº”ç”¨å§ã€‚ &lt;br>
é¦–å…ˆï¼Œæ‰“å¼€&lt;a class="link" href="https://workers.cloudflare.com/" target="_blank" rel="noopener"
>å®˜ç½‘&lt;/a>ï¼Œæ³¨å†Œæˆ–ç™»å½•ä½ çš„ Cloudflare å¸å·ï¼Œç‚¹å‡» Start buildingï¼Œé€‰æ‹©å…è´¹æ–¹æ¡ˆå¹¶åˆ›å»ºä¸€ä¸ªä¸“å±çš„å­åŸŸåï¼ˆæ˜¯ workers.dev çš„å­åŸŸåï¼‰ï¼Œè¿›å…¥ä¸»é¡µåç‚¹å‡» Create a Workerï¼Œå¤åˆ¶&lt;a class="link" href="https://gitlab.com/NickCao/experiments/-/blob/master/workers/r.js" target="_blank" rel="noopener"
>è¿™ä»½ä»£ç &lt;/a>ï¼Œåƒä¸‹å›¾è¿™æ ·ç²˜è´´åˆ°ç¼–è¾‘æ¡†å†…ï¼š&lt;/p>
&lt;p>&lt;img src="https://viflythink.com/Use_GitHubActions_to_build_AUR/create_cloudflare_workers.png"
width="1918"
height="835"
loading="lazy"
alt="åˆ›å»º Cloudflare Workers åº”ç”¨"
class="gallery-image"
data-flex-grow="229"
data-flex-basis="551px"
>&lt;/p>
&lt;p>æ³¨æ„ï¼Œé¡µé¢ä¸­é—´çš„åŸŸåæ˜¯ Cloudflare Workers åˆ†é…ç»™ä½ çš„ä¸€ä¸ªä¸“å±å­åŸŸåï¼ˆå½¢å¦‚ xxx.xxx.workers.devï¼‰ï¼Œå¤åˆ¶è¿™ä¸ªåŸŸåå¹¶ç”¨å®ƒæ›¿æ¢å·¦ä¾§ä»£ç ä¸­çš„ä¸¤å¤„åŸŸåï¼Œå®Œæˆä¿®æ”¹åç‚¹å‡» Save and Deploy ä¿å­˜å¹¶éƒ¨ç½²ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªå¯ä»¥åä»£ç½‘ç»œèµ„æºçš„åº”ç”¨äº†ã€‚&lt;/p>
&lt;p>æœ€åï¼Œè¿˜è®°å¾—åœ¨ä¸Šä¸€å°èŠ‚ä¸­è¢«å¿½ç•¥çš„ ProxyURL é…ç½®é¡¹å—ï¼Œè¿™é‡Œå„ä½åªéœ€å¡«å…¥åˆšåˆšå¾—åˆ°çš„ xxx.xxx.workers.dev åŸŸåå°±å¯ä»¥äº†ï¼Œè„šæœ¬ä¼šä½¿ç”¨è¿™ä¸ªåä»£åŸŸåé«˜é€Ÿä¸‹è½½ GitHub Releases çš„è½¯ä»¶åŒ…ã€‚&lt;/p></description></item></channel></rss>