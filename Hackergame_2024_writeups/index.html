<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="第十一届中科大信息安全大赛（Hackergame 2024）的经历与题解"><title>2024 中科大信息安全大赛题解</title><link rel=canonical href=https://viflythink.com/Hackergame_2024_writeups/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="2024 中科大信息安全大赛题解"><meta property='og:description' content="第十一届中科大信息安全大赛（Hackergame 2024）的经历与题解"><meta property='og:url' content='https://viflythink.com/Hackergame_2024_writeups/'><meta property='og:site_name' content='Vifly 的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='信息安全'><meta property='article:published_time' content='2024-11-12T00:00:00+08:00'><meta property='article:modified_time' content='2024-11-12T00:00:00+08:00'><meta property='og:image' content='https://viflythink.com/Hackergame_2024_writeups/show.jpg'><meta name=twitter:title content="2024 中科大信息安全大赛题解"><meta name=twitter:description content="第十一届中科大信息安全大赛（Hackergame 2024）的经历与题解"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://viflythink.com/Hackergame_2024_writeups/show.jpg'><link rel="shortcut icon" href=/img/favicon.png><meta name=google-site-verification content="o-widUnxdyv8T6wPC_NGLfDgKUwgv2-zMnQhKLKul3Y"><meta name=msvalidate.01 content="D8C8D2BAD9DA419D96DA79455FC4DDBC"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu12531115325737032784.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Vifly 的博客</a></h1><script>fetch("https://api.github.com/gists/7a04e2188185ddb19cbd19d8217b9400").then(e=>{if(e.ok)return e.json();throw new Error("Unable to fetch gist slogans.")}).then(e=>JSON.parse(e.files["slogans.json"].content)).then(e=>e[Math.floor(Math.random()*e.length)].content).then(e=>{document.getElementById("slogan").innerHTML="<h2 id='slogan' class='site-description'>"+e+"</h2>"})</script><h2 id=slogan class=site-description></h2></div></header><ol class=menu-social><li><a href=mailto:viflythink@gmail.com target=_blank title=Email rel=me><svg class="icon icon-tabler icon-tabler-mail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg></a></li><li><a href=https://github.com/vifly target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://viflythink.com/atom.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://t.me/viflythink target=_blank title=Telegram rel=me><svg class="icon icon-tabler icon-tabler-brand-telegram" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://twitter.com/viflythink target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/ target=_blank><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/service/><svg class="icon icon-tabler icon-tabler-cloud" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 18a4.6 4.4.0 010-9 5 4.5.0 0111 2h1a3.5 3.5.0 010 7H7"/></svg>
<span>Service</span></a></li><li><a href=/gpg/><svg class="icon icon-tabler icon-tabler-key" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="8" cy="15" r="4"/><line x1="10.85" y1="12.15" x2="19" y2="4"/><line x1="18" y1="5" x2="20" y2="7"/><line x1="15" y1="8" x2="17" y2="10"/></svg>
<span>GPG key</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#签到>签到</a></li><li><a href=#喜欢做签到的-ctfer-你们好呀>喜欢做签到的 CTFer 你们好呀</a></li><li><a href=#猫咪问答hackergame-十周年纪念版>猫咪问答（Hackergame 十周年纪念版）</a></li><li><a href=#打不开的盒>打不开的盒</a></li><li><a href=#比大小王>比大小王</a></li><li><a href=#旅行照片-40>旅行照片 4.0</a><ol><li><a href=#题目-1-2>题目 1-2</a></li></ol></li><li><a href=#nodejs-is-web-scale>Node.js is Web Scale</a></li><li><a href=#paolugpt>PaoluGPT</a></li><li><a href=#惜字如金-30>惜字如金 3.0</a><ol><li><a href=#题目-a>题目 A</a></li></ol></li><li><a href=#不太分布式的软总线>不太分布式的软总线</a><ol><li><a href=#what-dbus-gonna-do>What DBus Gonna Do?</a></li><li><a href=#if-i-could-be-a-file-descriptor>If I Could Be A File Descriptor</a></li></ol></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/Hackergame_2024_writeups/><img src=/Hackergame_2024_writeups/show_hu17472768623662148169.jpg srcset="/Hackergame_2024_writeups/show_hu17472768623662148169.jpg 800w, /Hackergame_2024_writeups/show_hu17067318525741586391.jpg 1600w" width=800 height=448 loading=lazy alt="Featured image of post 2024 中科大信息安全大赛题解"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/Hackergame_2024_writeups/>2024 中科大信息安全大赛题解</a></h2><h3 class=article-subtitle>第十一届中科大信息安全大赛（Hackergame 2024）的经历与题解</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024 年 11 月 12 日</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>7 minute read</time></div></footer></div></header><section class=article-content><p>又到了更新年更系列的时间，真没想到今年组委会还在 go（好吧，其实我也是，本文头图同样来源于此）。对我来说，今年花在比赛上的时间明显比往年少了，一方面是因为刚旅游回来太累了，而另一方面则是在 LLM 的帮助下一些简单的题目不再需要更多的时间来解决了。今年只拿了 1850 分，与<a class=link href=https://viflythink.com/Hackergame_2023_writeups/ target=_blank rel=noopener>上一年</a>相比算是退步了，依旧在三百名左右徘徊，只能说我才是最该多练习的人（笑）。</p><h1 id=签到>签到</h1><p>今年的签到题又选了某知名手游来玩梗，要求在 60 秒内输入 12 种不同语言的启动，作为 CTF 玩家那肯定不会傻傻按照这个要求来做的，随便输入点什么然后点击下面的“等不及了，马上启动！”，看到跳转的 URL 有一个 pass 参数，将参数值改为 true，搞定。</p><p><img src=/Hackergame_2024_writeups/get_2024_qiandao_flag.jpg width=1920 height=973 loading=lazy alt="成功获取签到题的 flag" class=gallery-image data-flex-grow=197 data-flex-basis=473px></p><h1 id=喜欢做签到的-ctfer-你们好呀>喜欢做签到的 CTFer 你们好呀</h1><p>Sodayo，我最喜欢做签到了，不过怎么又是选了某个手游作为题图玩梗（虽然跟签到不是同一个）。</p><p>搜索中科大 CTF 战队招新找到了<a class=link href=https://github.com/Nebula-CTFTeam/Recruitment-2024 target=_blank rel=noopener>相关文章</a>，琢磨了一会后得出结论除非这题考隐写术或者挖 Git 提交历史不然这里应该没什么好挖的，然后找到了<a class=link href=https://nebuu.la/ target=_blank rel=noopener>战队主页</a>，居然是模拟终端进行交互的网页，随手试了几个指令后发现 <code>env</code> 给出了第一个 flag：</p><p><img src=/Hackergame_2024_writeups/get_flag1_from_nebula.jpg width=1024 height=163 loading=lazy alt="env 拿到 Nebula 的第一个 flag" class=gallery-image data-flex-grow=628 data-flex-basis=1507px></p><p>至于另一个 flag，找不到什么思路，想到这是 web 题，尝试在前端代码里搜索 flag，发现了惊喜：</p><p><img src=/Hackergame_2024_writeups/search_flag_on_nebula_js.jpg width=811 height=1024 loading=lazy alt="在 Nebula 前端代码里搜索 flag" class=gallery-image data-flex-grow=79 data-flex-basis=190px></p><p>第一个结果看上去是 <code>ls</code> 列出的结果，用 <code>ls -a</code> 列出所有项目试试：</p><p><img src=/Hackergame_2024_writeups/get_flag2_from_nebula.jpg width=1024 height=177 loading=lazy alt="拿到 Nebula 的第二个 flag" class=gallery-image data-flex-grow=578 data-flex-basis=1388px></p><h1 id=猫咪问答hackergame-十周年纪念版>猫咪问答（Hackergame 十周年纪念版）</h1><p>又见到考验信息检索能力的题目，还是十周年纪念版呢。</p><p>第一小题，搜索“中科大信息安全大赛 2015”找到一篇报道：<a class=link href=https://tengdahuanbao.com/html/20151211c6485a87199page.html target=_blank rel=noopener>中国科学技术大学2015信息安全大赛圆满结束</a>，其中提到：</p><blockquote><p>主办方在10月17号晚在3A204举办了一场赛前培训</p></blockquote><p>第二小题暴力破解，搜近五年的 Hackergame 新闻稿并查找里面的注册参加人数，最后发现答案是 2019 年的 Hackergame，人数是 2682。<em>PS：怎么近两年的 Hackergame 新闻稿都没有精确的注册参加人数。</em></p><p>第三小题从问题来看这应该能从 <a class=link href=https://github.com/ustclug/hackergame2018-writeups/blob/master/official/ustcquiz/README.md target=_blank rel=noopener>Hackergame 2018 的猫咪问答题解</a> 找到答案，而且给了提示：仅由中文汉字构成，所以答案是程序员的自我修养。</p><p>第四小题搜索“USENIX Security ustc”并把时间限定在今年就能找到<a class=link href=https://www.usenix.org/system/files/usenixsecurity24-ma-jinrui.pdf target=_blank rel=noopener>对应论文</a>，不想看论文所以把 PDF 丢给 LLM 得到答案：336。</p><p>第五小题，可能有不少人都知道这个最近发生的争议性很大的新闻，此事掀起了新一轮有关开源与地缘政治之间关系的讨论，正好之前看到的<a class=link href=https://lwn.net/Articles/995186/ target=_blank rel=noopener>对应报道</a>有附上<a class=link href=https://git.kernel.org/linus/6e90b675cf94 target=_blank rel=noopener>这个提交的链接</a>，得到答案：6e90b6。</p><p>第六小题，跑不起来 LLM 的童鞋怎么办呢，先尝试一下搜索引擎吧。谷歌输入 llama 3 tokenizer 后有个候选结果：llama 3 tokenizer online，搜索这个然后随便选择<a class=link href=https://token-counter.app/meta/llama-3 target=_blank rel=noopener>一个网站</a>，把猫咪问答页面 HTML 复制粘贴上去，计算出来的 token count 是 1812，提交结果发现不对，那就靠<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-cat_answers-py target=_blank rel=noopener>脚本</a>暴破吧，最后得到的答案是 1833。</p><h1 id=打不开的盒>打不开的盒</h1><p>既然题目都这样说了，那先尝试打开这个 3D 模型看看吧，随手找了一个软件：<a class=link href=https://github.com/fstl-app/fstl target=_blank rel=noopener>fstl</a>，变换角度后看到了 flag：</p><p><img src=/Hackergame_2024_writeups/get_flag_from_stl.jpg width=1024 height=586 loading=lazy alt="打开 STL 文件看到 flag" class=gallery-image data-flex-grow=174 data-flex-basis=419px></p><p><em>PS：脖子快扭了，以及对于这个 flag：flag{Dr4W_Us!nG_fR3E_C4D!!w0W}，只能说 free CAD 我还真没用过。</em></p><h1 id=比大小王>比大小王</h1><p>本题来源于今年一堆人在小猿口算里欺负小学生的事情（无语），看来出题人也想让大家体会一下寻找口算平台漏洞的快乐，原以为是可以像当时的小猿口算那样直接篡改分数，分析了一下前端代码后发现不行，那解题思路就只剩下把题目全自动化求解然后提交，正好适合萌新入门自动化脚本，唯一要注意的事情是求解完后要等九秒再提交，不然会出现“检测到时空穿越”的错误（上一年是不是见过这个😂），代码<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-hack_compare-py target=_blank rel=noopener>在这里</a>。</p><h1 id=旅行照片-40>旅行照片 4.0</h1><p>没想到今年还有社会工程学题目，只能说挖信息的方法真是多种多样啊。虽说已经连续几年见到旅行照片了，不过今年还是只完成了最简单的部分。</p><h2 id=题目-1-2>题目 1-2</h2><p>第一小题考虑到校门数量也不多，直接暴破吧，得到答案：东校区西门。第二小题搜索“中科大2024ACG音乐会日期”就能获得答案：20240519。</p><h1 id=nodejs-is-web-scale>Node.js is Web Scale</h1><p>从本题开始进入真正的 web 安全领域了，我对 JS 不怎么熟悉，后端代码里虽说有一行“Run commands which are constant and obviously safe.”这样有暗示性的注释，但我也不知道怎么利用，把代码丢给 LLM 让其分析有什么可利用的地方，直接找到了关键点：可以通过原型链污染添加任意指令。我只能表示居然还能这么玩😦，JS 真是太神奇了。执行以下两条指令即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>curl -X POST <span class=s2>&#34;https://&lt;REPLACE_IT&gt;.hack-challenge.lug.ustc.edu.cn:8443/set&#34;</span> -H <span class=s2>&#34;Content-Type: application/json&#34;</span> -d <span class=s1>&#39;{&#34;key&#34;: &#34;__proto__.flag&#34;, &#34;value&#34;: &#34;cat /flag&#34;}&#39;</span>
</span></span><span class=line><span class=cl>curl <span class=s2>&#34;https://&lt;REPLACE_IT&gt;.hack-challenge.lug.ustc.edu.cn:8443/execute?cmd=flag&#34;</span>
</span></span></code></pre></div><h1 id=paolugpt>PaoluGPT</h1><p>既然给了后端源码那肯定要先读一遍，发现 view 函数里有不对劲的地方：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=n>execute_query</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;select title, contents from messages where id = &#39;</span><span class=si>{</span><span class=n>conversation_id</span><span class=si>}</span><span class=s2>&#39;&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>这个 SQL 语句居然用字符串操作，我立刻就想到了通过 SQL 注入直接拖库，询问 LLM 得到只要构造出 <code>select title, contents from messages where id = '114514' or 1=1</code> 这样的语句就可以拿到 messages 表里的全部行了，至于原来字符串里的 &rsquo; 如何解决呢，用<a class=link href=https://book.hacktricks.xyz/pentesting-web/sql-injection#comments target=_blank rel=noopener>注释</a>把第二个 &rsquo; 给注释掉就行。兴高采烈的我尝试了将 conversation_id 设置为 <code>114514' OR 1=1 --</code> 后发送请求，然后发现只返回了第一条，再次阅读代码发现是查询数据库用了 fetchone，只能返回一行。那就只能写个<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-hack_paolugpt-py target=_blank rel=noopener>脚本</a>遍历全部行来拖库了，执行脚本然后在保存的文件里查找 flag 得到本题的两个 flag。第二个 flag 需要注意 HTML 转义，其应当为 flag{enJ0y_y0uR_Sq1_&_1_would_xiaZHOU_hUI_guo_abeff7b2f2}。</p><h1 id=惜字如金-30>惜字如金 3.0</h1><p>又碰到了熟悉的惜字如金，上一年就是靠它拿到了一点 math 题的分数，今年看来也是这样。</p><h2 id=题目-a>题目 A</h2><p>我不知道这算 math 题吗，唯一的难点应该是有些童鞋不熟悉 Python 语法。选一个带语法高亮的编辑器打开文件并添加字符修复语法错误就行，题目甚至还很贴心地提醒你最后结果应当是每行有 80 个字符，用 Kate 编辑完成并保存后发现它在保存时自动把填充的空格去掉了，又写了个<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-padding-py target=_blank rel=noopener>脚本</a>把每一行自动填充到 80 个字符，提交拿到 flag。这里附上<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-original_answer_a-py target=_blank rel=noopener>还原后的 answer_a.py</a>。</p><h1 id=不太分布式的软总线>不太分布式的软总线</h1><p>看到题目，作为 Fcitx5 输入法贡献者的我瞬间开始兴奋了：这个我知道。D-Bus 作为 Linux 上常见的一种 IPC（进程间通信）手段，在很多你没有注意到的地方都有所应用，例如在 X11 下 Fcitx 主要就是通过 D-Bus 与其它应用进行通信，由作为客户端的应用发送按键等数据到作为服务端的 Fcitx，然后 Fcitx 负责返回候选词等事项，具体代码在<a class=link href=https://github.com/fcitx/fcitx5/tree/master/src/frontend/dbusfrontend target=_blank rel=noopener>这里</a>。当然，Fcitx 还通过 D-Bus 注册了其它的方法，例如各位使用 Fcitx5 的童鞋可以通过 <code>dbus-send --session --print-reply --dest=org.fcitx.Fcitx5 /controller org.fcitx.Fcitx.Controller1.DebugInfo</code> 来查看当前与 Fcitx5 通信的应用及其使用的前端（Fcitx5 支持的所有前端在<a class=link href=https://github.com/fcitx/fcitx5/tree/master/src/frontend target=_blank rel=noopener>此</a>查看）。</p><p>如何在自己的应用中使用 D-Bus 呢，只要理解作为接收方怎样做才能接收到消息就行。作为接收方，你通常需要有 name、object、interface 等并注册才能收到消息，它们的关系如下图：</p><p><img src=/Hackergame_2024_writeups/dbus.jpg width=944 height=789 loading=lazy alt=D-Bus class=gallery-image data-flex-grow=119 data-flex-basis=287px></p><p>因上图没有体现出来，这里补充一下，每个 interface 都可以有多个属于自己的 property、method、signal，以及 name 是全局唯一的。</p><p>现在用刚学到的知识来从发送端的角度理解一下上面的 Fcitx5 的例子：<code>org.fcitx.Fcitx5</code> 就是 name（可以理解为监听的地址），<code>/controller</code> 是 object（更准确来说是 object path），而 <code>org.fcitx.Fcitx.Controller1.DebugInfo</code> 则是 method。还有一点要注意，<code>--session</code> 参数指示 dbus-send 把消息发送到 session 总线上，与之相对的是 <code>--system</code> 参数，顾名思义它会把消息发送到系统总线，按<a class=link href=https://elmarco.pages.freedesktop.org/dbus-page/docs/getting-started/ target=_blank rel=noopener>这里</a>的说法系统总线是总是可以被访问的。</p><p>现在我们开始看本题的源码（flagserver.c），可以看到其监听系统总线（说明我们给其发送的消息总是可达的）并且注册的 name 为 <code>cn.edu.ustc.lug.hack.FlagService</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>owner_id</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=nf>g_bus_own_name</span><span class=p>(</span><span class=n>G_BUS_TYPE_SYSTEM</span><span class=p>,</span> <span class=s>&#34;cn.edu.ustc.lug.hack.FlagService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                     <span class=n>G_BUS_NAME_OWNER_FLAGS_NONE</span><span class=p>,</span> <span class=n>on_bus_acquired</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                     <span class=n>on_name_acquired</span><span class=p>,</span> <span class=n>on_name_lost</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span></code></pre></div><p>注册的 object path：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>g_dbus_connection_register_object</span><span class=p>(</span><span class=n>connection</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=s>&#34;/cn/edu/ustc/lug/hack/FlagService&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                    <span class=n>introspection_data</span><span class=o>-&gt;</span><span class=n>interfaces</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                                    <span class=o>&amp;</span><span class=n>interface_vtable</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=cm>/* user_data */</span>
</span></span><span class=line><span class=cl>                                    <span class=nb>NULL</span><span class=p>,</span> <span class=cm>/* GDestroyNotify */</span>
</span></span><span class=line><span class=cl>                                    <span class=o>&amp;</span><span class=n>error</span><span class=p>);</span>
</span></span></code></pre></div><p>至于 method 则是在 xml 字符串里，这里就不贴了。</p><h2 id=what-dbus-gonna-do>What DBus Gonna Do?</h2><p>要求传入一个特定的字符串：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>g_variant_is_of_type</span><span class=p>(</span><span class=n>parameters</span><span class=p>,</span> <span class=nf>G_VARIANT_TYPE</span><span class=p>(</span><span class=s>&#34;(s)&#34;</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nf>respond_error_msg</span><span class=p>(</span><span class=n>invocation</span><span class=p>,</span> <span class=s>&#34;Give me a string, please.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>按照 <a class=link href=https://dbus.freedesktop.org/doc/dbus-send.1.html target=_blank rel=noopener>dbus-send 的文档</a>可以构造出来以下指令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>dbus-send --system --print-reply --dest<span class=o>=</span>cn.edu.ustc.lug.hack.FlagService /cn/edu/ustc/lug/hack/FlagService cn.edu.ustc.lug.hack.FlagService.GetFlag1 string:<span class=s2>&#34;Please give me flag1&#34;</span>
</span></span></code></pre></div><p>将其保存为 shell 文件并上传就搞定了，与 Fcitx5 的例子相比也就多了一个需要传入的参数，应该不难理解。</p><h2 id=if-i-could-be-a-file-descriptor>If I Could Be A File Descriptor</h2><p>要求必须是文件描述符：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>g_variant_is_of_type</span><span class=p>(</span><span class=n>parameters</span><span class=p>,</span> <span class=nf>G_VARIANT_TYPE</span><span class=p>(</span><span class=s>&#34;(h)&#34;</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nf>respond_error_msg</span><span class=p>(</span><span class=n>invocation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=s>&#34;Give me a file descriptor, please.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p>而在 <a class=link href=https://dbus.freedesktop.org/doc/dbus-send.1.html target=_blank rel=noopener>dbus-send 的文档</a> 列举出来的支持的数据类型中并不包括文件描述符，所以只能写 C 语言代码了。</p><p>还注意到代码里会检测文件描述符是否存在于文件系统：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>g_snprintf</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>path</span><span class=p>),</span> <span class=s>&#34;/proc/self/fd/%d&#34;</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>gchar</span> <span class=o>*</span><span class=n>link</span> <span class=o>=</span> <span class=nf>g_file_read_link</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>link</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>g_strstr_len</span><span class=p>(</span><span class=n>link</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=s>&#34;/&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>respond_error_msg</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>invocation</span><span class=p>,</span> <span class=s>&#34;Please don&#39;t give me a file on disk to trick me!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>我从来没觉得写 C 快乐过，把这些需求丢给 LLM，其给出了使用 socket pair 的办法，代码在<a class=link href=https://gist.github.com/vifly/67e439ac69eff8c4c6ae94fe2ca92b15#file-dbus_2-c target=_blank rel=noopener>此</a>，运行以下指令编译然后上传：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>gcc dbus_2.c <span class=sb>`</span>pkg-config --cflags --libs gio-2.0<span class=sb>`</span> -o dbus_2
</span></span></code></pre></div><h1 id=总结>总结</h1><p>今年的 SQL 和 D-Bus 题还是玩的很开心的，前者尝试构造 payload 的过程还是相当有趣的，而 D-Bus 的话正好是我之前想写的内容。另外 PowerfulShell 是相当令我残念的一道题，都已经找到 <code>$-</code> 和 <code>$_</code> 这样的变量了，就是没想到要赋值给 <code>_1</code> 这样的变量。可惜今年毕竟投入的时间不多，看到 C 和汇编基本都是绕路走，像是 D-Bus 的第三小题都懒得看了，事后看题解发现也不难，不知道明年是否会有更多的时间来玩呢，我们下一年再见吧。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/>信息安全</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/Hackergame_2023_writeups/><div class=article-image><img src=/Hackergame_2023_writeups/show.9e6a7796dffc8c8988faef26f3cccb7f_hu16493141837001838012.jpg width=250 height=150 loading=lazy alt="Featured image of post 2023 中科大信息安全大赛题解" data-hash="md5-nmp3lt/8jImI+u8m88zLfw=="></div><div class=article-details><h2 class=article-title>2023 中科大信息安全大赛题解</h2></div></a></article><article class=has-image><a href=/Hackergame_2022_writeups/><div class=article-image><img src=/Hackergame_2022_writeups/show.1bf2cbb7d935f5fe193a14cdcaaab42c_hu6206239678704823438.jpg width=250 height=150 loading=lazy alt="Featured image of post 2022 中科大信息安全大赛题解" data-hash="md5-G/LLt9k19f4ZOhTNyqq0LA=="></div><div class=article-details><h2 class=article-title>2022 中科大信息安全大赛题解</h2></div></a></article><article class=has-image><a href=/Hackergame_2021_writeups/><div class=article-image><img src=/Hackergame_2021_writeups/show.02a042ed813f37a77d72aef0074d5c68_hu8696676125516822855.jpg width=250 height=150 loading=lazy alt="Featured image of post 2021 中科大信息安全大赛题解" data-hash="md5-AqBC7YE/N6d9cq7wB01caA=="></div><div class=article-details><h2 class=article-title>2021 中科大信息安全大赛题解</h2></div></a></article><article class=has-image><a href=/Hackergame_2020_writeups/><div class=article-image><img src=/Hackergame_2020_writeups/show.961f9901878e2b82abaaeb7e1f326343_hu16165770761244031161.jpg width=250 height=150 loading=lazy alt="Featured image of post 中科大信息安全大赛初体验" data-hash="md5-lh+ZAYeOK4Krqut+HzJjQw=="></div><div class=article-details><h2 class=article-title>中科大信息安全大赛初体验</h2></div></a></article><article class=has-image><a href=/translate_elliptic_curve_cryptography_explained/><div class=article-image><img src=/translate_elliptic_curve_cryptography_explained/show.8ac351075994593ec66b34bae84b47b5_hu15087704017533769591.jpg width=250 height=150 loading=lazy alt="Featured image of post 【译】椭圆曲线密码介绍" data-hash="md5-isNRB1mUWT7GazS66EtHtQ=="></div><div class=article-details><h2 class=article-title>【译】椭圆曲线密码介绍</h2></div></a></article></div></div></aside><div id=isso-comment><script data-isso=https://comments.viflythink.com/isso/ data-isso-css=true data-isso-lang=zh_CN data-isso-reply-to-self=true data-isso-require-author=true data-isso-require-email=false data-isso-max-comments-top=10 data-isso-max-comments-nested=5 data-isso-reveal-on-click=5 data-isso-avatar=true data-isso-vote=true data-isso-vote-levels data-isso-feed=false src=https://comments.viflythink.com/isso/js/embed.min.js></script><section id=isso-thread></section></div><style>#isso-comment{background-color:#eee;padding:2pc}</style><footer class=site-footer><section class=copyright>&copy;
2019 -
2024 Vifly 的博客</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://viflythink.com/js/photoswipe.min.js crossorigin=anonymous defer></script><script src=https://viflythink.com/js/photoswipe-ui-default.min.js crossorigin=anonymous defer></script><link rel=stylesheet href=https://viflythink.com/css/default-skin.css crossorigin=anonymous><link rel=stylesheet href=https://viflythink.com/css/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://viflythink.com/css/photoswipe.css crossorigin=anonymous><link rel=stylesheet href=https://viflythink.com/css/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://viflythink.com/js/vibrant.min.js crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>